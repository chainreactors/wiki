
# Internet of Malice  下一代进攻性基础设施白皮书  

---

## 概述

在当今高度动态和复杂的网络安全环境中，企业面临着日益增长的高级威胁，传统的防御性措施已不足以应对这些挑战。为了有效应对高级威胁行为者（Advanced Persistent Threats, APTs）的战术、技术和程序（TTPs），企业蓝军需要一套先进的工具来模拟真实的攻击行为，测试组织的防御能力并提升整体安全态势。**Internet of Malice (IoM)** 应运而生，作为一套专为企业蓝军设计的进攻性基础设施。

旨在为企业蓝军提供一套模块化、可扩展且技术先进的进攻性基础设施，以模拟高级威胁行为、识别防御漏洞并提升组织的安全态势。

IoM 的核心使命是通过一个强大的命令与控制（C2）框架，帮助企业蓝军模拟高级威胁行为，识别潜在漏洞，并制定更有效的防御策略。本白皮书将详细介绍 IoM 的设计理念、技术架构、主要功能及其在企业网络安全中的应用价值。


---

## 背景与市场需求  
### 网络安全对抗的演变  
现代攻防已从理论环境转向实网对抗，防守方通过EDR、NDR、零信任等技术构建纵深防护体系。然而，攻击模拟领域仍面临以下挑战：  

1. **基础设施碎片化**：红队需自研工具链，缺乏标准化、工程化的解决方案。  
2. **生态封闭性**：主流C2框架（如CobaltStrike）闭源且受限出口，难以满足定制化需求。  
3. **对抗能力不足**：传统工具在端上行为隐蔽性、流量混淆、插件生态等方面存在短板。  

### C2生态的演变

C2具有二十多年的历史， 有无数的内部/开源工具在出现过。 而我们总结了前人的经验， 弥补了现有的缺陷，以**现代的视角重新设计**了下一代进攻性基础设施

- sliver/havoc 代表的开源生态的单一且滞后， 绝大多数开源工具都只支持单一的拓展、代码高度耦合、implant技术落后、 难以二开等问题。
- cobaltstrike/MSF 作为最老牌C2工具， 他们的二开版本至今仍在活跃。 但也面临二开与最新版本脱节、设计老旧无法大规模改动的问题。
- nighthawk/brc4 代表了新兴的商业C2工具， 他们拥有较好的OPSEC设计以及持续迭代维护的技术团队。 但生态较为封闭，用户无法基于此沉淀为自己的基础设施， 只能长期依赖于第三方的技术团队更新功能。
### 企业蓝军的需求

企业蓝军作为内部安全团队的核心组成部分，肩负着模拟攻击、评估防御和提升安全能力的重要职责。为此，他们需要的基础设施具备以下特性：

- **高级威胁模拟**：能够真实再现 APT 的 TTPs，包括隐秘通信、进程注入和持久化驻留。
- **灵活性和可扩展性**：支持根据企业特定需求定制功能，适应多样化的网络环境。
- **操作安全性（OPSEC）**：在模拟攻击时最大限度降低暴露风险，避免触发安全设备的警报。
- **跨平台支持**：覆盖主流操作系统（如 Windows、Linux 和 macOS），确保全面测试能力。
- **社区与生态支持**：整合现有红队工具生态（如 CobaltStrike BOF 和 Sliver Armory），减少学习曲线并提升效率。

### 红队的需求

红队是更直接的需求者，大多数red team面临着基础设施匮乏、技术积累难以迭代、OPSEC落后的问题。 而最简单的解决方案是通过修改开源的工具， 逐渐积累成内部的武器库，这需要极强的人力投入与时间积累。 而IoM将提供一套可以持续改进、技术先进、高度解耦的解决方案。 让红队能拥有一套基础设施的底座。

- **高对抗性：** IoM长期致力于EDR、NDR等设备的对抗， 有极为丰富的技术积累与方案沉淀
- **开箱即用：** 将复杂的技术包装为武器， 经过简单的培训即可上手
- **持续改进：** 可拓展性作为IoM核心设计理念， 适合不同场景的用户根据自己的需求持续改进
- **高度定制化：** 我们拥有经验丰富的研发团队， 持续改进IoM以及提供定制化开发服务，只需要最小的成本即可获得最先进的功能。 

### 面向AI

IoM采用了开放的技术架构，在v0.1.0版本中接入了MCP，并且基于VSCode extension实现了我们的GUI。 现在可以直接通过VSCode上的AI插件接管IoM。

- AI chat， 基于我们的文档自动回答
- AI agent， 基于MCP接管IoM实现自然语言驱动的自动化操作
- AI coding， 基于VSCoding的AI编程插件，自动编写插件，可以自动化编写代码编译后通过implant执行

**IoM 正是为满足这些需求而设计的新一代进攻性基础设施。**

---

## 技术架构

### 设计理念

IoM 的设计围绕以下三大支柱展开匹配

1. **模块化与可扩展性**  
    IoM的模块化设计允许用户根据任务需求动态加载或定制功能模块，确保在不同场景下的灵活应用，同时支持Rust语言的跨平台编译能力，提供无与伦比的定制自由度。
2. **操作安全性（OPSEC）优先**  
    IoM 引入基于 ATT&CK 框架的 OPSEC 模型，从暴露度、痕迹、检测可能性和后果四个维度评估操作风险，帮助用户在模拟攻击时保持隐蔽性。
3. **跨平台与生态兼容**  
    IoM 支持多操作系统和网络环境，并兼容主流红队工具的插件生态（如 CobaltStrike 的 BOF / Assembly 和 Sliver 的 Armory），为用户提供无缝的迁移和使用体验。

### 架构概述

Internet of Malice (IoM) 是一套模块化、解耦的命令与控制 (C2) 框架，专为企业蓝军设计，用于模拟高级威胁，测试防御能力并提升安全态势。其架构由四个核心组件组成：**服务器 (Server)**、**监听器 (Listener)**、**植入物 (Implant)** 和 **客户端 (Client)**，通过高效通信协议协作，确保灵活性和操作安全性。所有组件均解耦设计，支持分布式部署。

#### 服务器 (Server)

- **通信**：通过 gRPC 实现与客户端的高效、安全通信。
- **存储**：使用持久化数据库确保操作可追溯。
- **配置**：支持统一配置文件，简化部署。

#### 监听器 (Listener)

- **分布式部署**：独立于服务器，分布式部署。
- **管道 (Pipeline)**：支持任意协议的监听器，适配 TCP、TLS、HTTP 等协议。
- **解析器 (Parser)**：自定义协议解析，支持第三方 C2 集成。

#### 植入物 (Implant)

- **跨平台**：标准支持 Windows、Linux、macOS。
- **OPSEC 工具**：提供间接系统调用、堆栈混淆，无文件攻击等功能。
- **动态模块**：运行时热加载模块，最小化静态检测特征。
- **自动化编译**: 支持基于docker与github action的自动化编译
- **模块化设计**：如同乐高一般， 几乎所有的功能都可以拆卸，组装，重载。

#### 客户端 (Client)

- **界面**：交互式命令行界面与基于VSCode Extension的图形化界面。
- **插件系统**：支持基于 Lua 和 Go实现的插件，提供丰富内置函数与插件包。
- **插件仓库**：社区驱动的插件生态管理（github.com/chainreactors/mals），支持一键安装

### 网络架构

采用了分布式 Listener与多协议pipeline。

客户端通过 gRPC 与服务器建立通信，服务器再利用自定义协议与分布式 Listener 进行交互，最终由 Listener 与植入物（Implant）完成数据传递。这种分层通信设计不仅提升了数据流的高效性，还通过协议隔离和分布式部署增强了安全性。

- **分布式 Listener**：系统采用解耦的 Listener 设计，支持分布式部署。每个 Listener 可以独立运行于不同的网络环境中，并通过自定义协议与服务器进行通信。这种设计能够在复杂的网络拓扑中提供灵活的通信路径，适应多样化的部署需求。
- **REM** （网络工具包）：通过rem可以实现正反向端口转发， 正反向代理，级联， 流量加密混淆，LOLC2(可信隧道)等等功能。打通Client， Listener， Implant三端的网络，实现相互之间的代理，端口转发等功能。

### implant 架构

implant 架构是系统的终端执行层，专注于轻量化、模块化和高对抗性设计，以满足多样化的任务需求。

- malefic, 主程序, 包含了beacon/bind两种模式的完整功能
- malefic-mutant, 用来实现自动化配置malefic的各种条件编译与特性, 以及生成shellcode, srdi等
- malefic-pulse, 最小化的shellcode模板, 对应CS的artifact, 能编译出只有4kb的上线马, 非常适合被各种loader加载
- malefic-prelude, 多段上线的中间阶段, 可以在这里按需配置权限维持, 反沙箱, 反调试等功能.
- malefic-srdi, 自研srdi技术, 最大程度减少PE特征

---
## 核心功能

我们自研了大量底层核心技术， 包括OLLVM Packer、自研堆栈混淆、自研SystemCallGate、Syscall Obfuscator、自研RDI、自研PIC loader、完全可控的流量代理技术等等，对大量核心技术重新实现并大幅优化与改进。重新架构起一套技术底座， 并在此之上持续迭代，将大量一线对抗经验源源不断沉淀为工程化基础设施。 
### OPSEC 模型

IoM 的操作安全性 (OPSEC) 模型是其核心优势之一，旨在帮助企业蓝队在模拟高级威胁时保持隐蔽性并降低检测风险。该模型基于 MITRE ATT&CK 框架，从端上对抗和流量对抗两个维度设计，提供全面的隐蔽性保障。以下为 OPSEC 模型的体系结构：

#### 端上对抗

- **静态特征混淆**：通过编译时条件控制（如 Rust 的 feature）和自定义资源（如图标、PE 元数据），OLLVM等降低静态分析的可检测性。
- **系统调用**：间接 syscall  , 堆栈混淆等手法实现绕过 EDR 监控，提升执行隐蔽性。
- **内存无文件执行**：支持反射加载（如 BOF、DLL、PE、Shellcode、CLR等）避免文件落地，减少痕迹。
- **模块化热插拔**：所有功能都可以通过模块化热加载，自定义多阶段加载。

#### 流量对抗

- **加密与混淆**： 定制化流量信道与加密方式，密码学前向/后向安全。
- **动态**：借助 Listener 的 Parser 机制，支持多协议上线(TCP,ICMP,DNS等) ，增强通信灵活性。
- **流量信道/代理**：结合 rem 代理工具，实现任意流量特征与信道的定制。

#### OPSEC评估

OPSEC 模型通过以下四个维度量化操作风险，评分范围为 0（高风险）至 10（极低风险）：

|**维度**|**定义**|**评估要点**|
|---|---|---|
|**暴露度**|操作被检测的程度|新进程创建、网络连接、API 调用等|
|**痕迹**|操作留下的可追踪痕迹|日志记录、文件残留|
|**检测可能性**|被现有安全设备识别的概率|EDR/NDR 的检测能力、行为特征复杂度|
|**后果**|操作失败可能带来的影响|是否影响长期潜伏或任务目标|

通过评分（0-10 分，10 分为最安全），用户可以量化操作风险并优化攻击策略。例如，评分达到 9.0-10 的操作被定义为“OPSEC 级”，几乎无检测风险且无明显后果。

这一模型不仅为蓝队提供了技术支持，还通过结构化评估指导攻击策略优化，确保模拟行为既真实又安全。IoM 的 OPSEC 设计使其在对抗高级检测技术（如 EDR、NDR 和行为分析）时具备显著优势。
### 生态兼容性

IoM 通过广泛的兼容性设计，与主流安全工具无缝集成，提升用户灵活性和效率。其核心兼容性包括：

| 兼容生态                | 实现方式                    | IoM | sliver | Cobaltstrike |
| ------------------- | ----------------------- | --- | ------ | ------------ |
| BOF                 | 基于rust自研的COFF loader    | ✅   | ✅      | ✅            |
| EXE/DLL             | 基于rust自研的PIC loader     | ✅   | ❌      | ❌            |
| UDRL                | 基于rust自研的RDI loader     | ✅   | donut  | ✅            |
| Shellcode           | Shellcode加载，可自定义的进程注入方式 | ✅   | ✅      | ✅            |
| C# Assembly         | CLR .NET 程序反射记载         | ✅   | ✅      | ✅            |
| Unmanned Powershell | CLR powershell反射加载      | ✅   | ❌      | ✅            |
| Sliver Armory       | client实现了sliver armory  | ✅   | ✅      | ❌            |

IoM 的生态兼容性是其设计中的一大亮点，旨在通过与现有工具和生态系统的无缝对接，为用户提供高效、灵活的使用体验。通过支持多种主流安全工具和模块类型，IoM 不仅能够快速融入用户现有的工作流程，还能显著提升功能的丰富性和实用性。 

这种广泛的兼容性设计使得 IoM 能够适应不同的应用场景，无论是红队演练、安全评估还是技术开发，用户都能依托现有资源快速上手，同时享受 IoM 带来的性能提升和功能扩展。通过降低迁移成本并提供灵活的集成方式，IoM 为用户打造了一个高效、易用的生态协作平台。

IoM迁移了大量CobaltStrike的常用工具集, 并封装为mals插件包，一键下载安装。

- lib , 包含多种通用加载器、 UDRL等
- commom (基础工具包) , 包含大量扫描工具、爆破工具、信息收集工具
- steal (凭证提取工具包), 包含 browser、keylogger、screenshot、clipboard、各类app等
- elevate (提权工具包), 包含大量提权, UAC绕过、权限操作工具
- persistence (权限维持工具包), 包含大量权限维持、自启工具
- move (横向移动工具包), 包含大量SMB、WMI、WINRM、DCOM、RPC横向移动工具
- proxy (网络工具包), 包含大量代理、隧道工具包
- domain (域渗透工具包)，包含大量域内信息收集、提权、权限维持、漏洞利用工具包
### 竞争优势

- **架构创新**  
    IoM采用Rust语言开发，利用其内存安全性和跨平台编译能力，确保了工具的高效性与稳定性。同时，IoM引入模块化设计和动态加载机制，用户可根据需求灵活定制功能，显著提升了工具的适应性。以及分布式Listener等等大量独有创新点。
- **功能优势**  
    IoM通过OPSEC（操作安全）模型和多阶段加载技术，大幅增强了操作的隐蔽性，有效降低了被检测的风险。此外，IoM支持与现有工具的无缝集成，用户无需大幅调整现有工作流程即可迁移至IoM。
- **国产可靠**  
    IoM绝大部分代码都在github平台上开源， 以供二次开发与审计。部分OPSEC相关的功能不开源， 用以实现不对称对抗。 

IoM主要面向企业蓝军、安全研究人员和红队成员，致力于为他们提供一套高效、隐蔽且易于扩展的网络安全工具。通过结合开源社区的协作与专业技术支持，IoM将持续迭代，满足用户在动态安全环境中的多样化需求。

### 应用场景

IoM 的设计使其适用于多种企业网络安全场景：

1. **渗透测试**  
    模拟真实攻击路径，测试防火墙、EDR 和 SIEM 的检测能力。
2. **红队演练**  
    执行高级威胁模拟，评估组织的应急响应和纵深防御能力。
3. **安全研究**  
    提供灵活的实验平台，用于开发和验证新的攻击技术与防御策略。
4. **蓝军能力建设**  
    为企业蓝军提供标准化的工具集，提升内部攻防演练的效率和效果。
5. **教育与培训**
	IoM如何在安全培训中帮助从业人员理解高级威胁的行为模式。

### 里程碑

| 版本     | 标题                    | 重点能力                                               |
| ------ | --------------------- | -------------------------------------------------- |
| v0.0.1 | 一下代C2计划               | 基本架构搭建、设计理念实践                                      |
| v0.0.2 | 真正的开始                 | Client插件框架、无文件攻击、自动化编译                             |
| v0.0.3 | 真正意义上的红队基础设施与C2框架     | Implant重构、多阶段加载、 SRDI、插件系统完善、OPSEC模型、协议解耦、大量新模块... |
| v0.0.4 | 自举                    | 新的自动化编译方式、操作系统兼容性提升、Client优化......                 |
| v0.1.0 | 代替CobaltStrike的最后四块拼图 | OLLVM落地、全面实现各种代理隧道、GUI、插件系统正式版、三端网络联通、免杀自动化......  |
| v0.1.1 | 开箱即用                  | SaaS自动化编译、内置mal插件合集、implant transport重构            |
| ...    |                       |                                                    |
未来版本将进一步优化GUI界面、增强自动化免杀能力，并引入更多高级OPSEC特性，如基于OLLVM的编译时混淆和Linux平台的全面支持。

---

## 可定制化的维度

IoM 提供了多维度的商业可定制化能力，以满足用户在不同场景下的需求。以下是其核心功能下可定制化的具体维度：
### EDR/杀软对抗

- **内存无文件执行**：自定义PE文件加载器、BOF加载器特征。 
- **系统调用**：定制堆栈混淆，syscall 实现方式。
- **代码混淆**：定制基于ollvm与rust特性实现的编译时自动混淆。

### 流量特征

- **自定义通信协议**：IoM 支持多种通信协议（如 HTTP、TCP、DNS 等），并允许用户根据需求选择或自定义协议，。
- **lolC2**: 支持 [lolc2](https://lolc2.github.io/)。
- **流量混淆**：支持定制流量加密方式与混淆方式。 

### 设备兼容与插件包

- **跨平台支持**：利用 Rust 语言的跨平台编译能力，IoM 可在多种 IoT 设备上部署，支持包括 ARM、MIPS 等架构，可定制特定操作系统兼容。
- **定制模块**：定制implant端的module，例如stealer、权限维持等。
- **定制插件包**：可以基于指定场景与需求定向开发mals插件包。


---

## 法律与合规性

### 使用许可

IoM采用 Apache 2.0开源许可，用户可在遵守许可协议的前提下自由使用、修改和分发工具。然而，用户在使用IoM时，必须确保其行为符合所在国家或地区的法律法规。任何未经授权或非法使用IoM的行为均不在许可范围之内。

### 合规性声明

IoM的设计和开发严格遵守网络安全领域的相关法律法规。工具的初衷是为合法的安全测试和研究提供支持，明确禁止将其用于任何非法活动。IoM开发团队不对用户在使用工具时可能引发的法律后果承担责任。用户应自行评估其使用场景的合法性，并承担相应义务。

### 道德使用

IoM鼓励用户在安全测试和研究中遵循道德准则，确保工具的使用不会对他人或组织造成不必要的损害。使用IoM时，用户应事先获得相关授权，并在操作中遵守职业道德和行业规范。通过合法、透明的使用方式，IoM旨在为网络安全社区提供正向价值。

---

## 结语

Internet of Malice (IoM) 是一款面向企业蓝军的新一代进攻性基础设施，通过其模块化设计、强大的 OPSEC 模型和广泛的生态兼容性，为用户提供了模拟高级威胁的全面工具集。无论是渗透测试、红队操作还是安全研究，IoM 都能帮助企业提升网络安全能力，更好地应对日益复杂的威胁环境。

我们相信，进攻是最好的防御。IoM 将成为企业蓝军不可或缺的战略资产，助力组织在网络攻防对抗中占据主动。

IoM将持续迭代，依托开源社区和专业支持，为企业蓝军提供最前沿的进攻性工具和技术支持，助力构建适应未来威胁的网络安全能力。